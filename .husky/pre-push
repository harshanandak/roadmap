#!/bin/sh

# Get current branch name
branch=$(git branch --show-current)

# Block push to main
if [ "$branch" = "main" ]; then
  echo ""
  echo "üö´ Direct push to main blocked!"
  echo ""
  echo "Please use the feature branch workflow:"
  echo "  1. git checkout -b feat/your-feature"
  echo "  2. Make changes and commit"
  echo "  3. git push -u origin feat/your-feature"
  echo "  4. Create PR: gh pr create"
  echo ""
  echo "Or if you REALLY need to push to main (emergency):"
  echo "  git push --no-verify"
  echo ""
  exit 1
fi

echo "‚úÖ Pushing to branch: $branch"
echo ""

# Run TypeScript type check
echo "üîç Running TypeScript type check..."
cd next-app
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå TypeScript errors found. Fix them before pushing."
  echo ""
  echo "To skip this check (emergency only):"
  echo "  git push --no-verify"
  echo ""
  cd ..
  exit 1
fi
echo "‚úÖ TypeScript check passed"
echo ""

# Run ESLint
echo "üîç Running ESLint..."
npx eslint src --max-warnings 0
if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå ESLint errors/warnings found. Fix them before pushing."
  echo ""
  echo "To skip this check (emergency only):"
  echo "  git push --no-verify"
  echo ""
  cd ..
  exit 1
fi
echo "‚úÖ ESLint check passed"

cd ..
echo ""
echo "‚úÖ All pre-push checks passed!"
echo ""
