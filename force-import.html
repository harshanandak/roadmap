<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Import Platform Data</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        .container {
            background: #1e293b;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }
        h1 { color: #60a5fa; margin-top: 0; }
        h2 { color: #38bdf8; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #2563eb; }
        button.success { background: #10b981; }
        button.danger { background: #ef4444; }
        input[type="file"] { margin: 15px 0; display: block; }
        #output {
            margin-top: 20px;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #334155;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #60a5fa; }
        .feature-preview {
            margin: 10px 0;
            padding: 10px;
            background: #334155;
            border-left: 3px solid #3b82f6;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Force Import with Timeline Data Fix</h1>
        <p style="color: #94a3b8;">This tool ensures timeline items are properly imported and displayed.</p>

        <h2>Step 1: Load Backup File</h2>
        <input type="file" id="fileInput" accept=".json">
        <button onclick="loadAndPreview()">ğŸ“‚ Load & Preview</button>

        <h2>Step 2: Import to LocalStorage</h2>
        <button onclick="forceImport()" class="success">âœ… Force Import (Overwrites Everything)</button>
        <button onclick="openMainApp()" class="info">ğŸš€ Open Main App</button>

        <div id="output"></div>
    </div>

    <script>
        let backupData = null;

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function loadAndPreview() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                log('âŒ Please select a file first!', 'error');
                return;
            }

            log('ğŸ“‚ Loading file: ' + file.name, 'info');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    document.getElementById('output').innerHTML = '';

                    backupData = JSON.parse(e.target.result);
                    log('âœ… File loaded successfully!', 'success');
                    log('', 'info');
                    log('ğŸ“Š BACKUP DATA ANALYSIS:', 'info');
                    log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 'info');
                    log(`Version: ${backupData.version || 'Unknown'}`, 'info');
                    log(`Workspaces: ${backupData.workspaces?.length || 0}`, 'info');
                    log(`Features: ${backupData.features?.length || 0}`, 'info');
                    log('', 'info');

                    if (backupData.features && backupData.features.length > 0) {
                        // Analyze timeline items
                        let totalTimelineItems = 0;
                        let featuresWithTimelines = 0;
                        let featuresWithoutTimelines = 0;

                        backupData.features.forEach(f => {
                            if (f.timelineItems && f.timelineItems.length > 0) {
                                totalTimelineItems += f.timelineItems.length;
                                featuresWithTimelines++;
                            } else {
                                featuresWithoutTimelines++;
                            }
                        });

                        log('ğŸ“ˆ TIMELINE ITEMS ANALYSIS:', 'info');
                        log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 'info');
                        log(`Features WITH timeline items: ${featuresWithTimelines}`, 'success');
                        log(`Features WITHOUT timeline items: ${featuresWithoutTimelines}`, featuresWithoutTimelines > 0 ? 'warning' : 'success');
                        log(`Total timeline items: ${totalTimelineItems}`, 'success');
                        log('', 'info');

                        // Show sample feature
                        log('ğŸ” SAMPLE FEATURE (first with timeline items):', 'info');
                        log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', 'info');
                        const sampleFeature = backupData.features.find(f => f.timelineItems && f.timelineItems.length > 0);

                        if (sampleFeature) {
                            log(`Name: ${sampleFeature.name}`, 'info');
                            log(`Workspace ID: ${sampleFeature.workspaceId}`, 'info');
                            log(`Timeline Items: ${sampleFeature.timelineItems.length}`, 'info');

                            sampleFeature.timelineItems.forEach((item, idx) => {
                                log(`  Item ${idx + 1}:`, 'info');
                                log(`    - Timeline: ${item.timeline || 'MISSING'}`, item.timeline ? 'success' : 'error');
                                log(`    - Difficulty: ${item.difficulty || 'MISSING'}`, item.difficulty ? 'success' : 'error');
                                log(`    - USP: ${item.usp ? 'Present (' + item.usp.substring(0, 40) + '...)' : 'MISSING'}`, item.usp ? 'success' : 'error');
                                log(`    - Integration: ${item.integrationType ? 'Present' : 'MISSING'}`, item.integrationType ? 'success' : 'error');
                            });
                        }

                        log('', 'info');
                        log('âœ… Ready to import! Click "Force Import" button above.', 'success');
                    } else {
                        log('âŒ No features found in backup!', 'error');
                    }

                } catch (error) {
                    log('âŒ Error parsing file: ' + error.message, 'error');
                    backupData = null;
                }
            };

            reader.readAsText(file);
        }

        function forceImport() {
            if (!backupData) {
                log('âŒ Please load a backup file first!', 'error');
                return;
            }

            log('', 'info');
            log('ğŸš€ STARTING FORCE IMPORT...', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');

            try {
                // Import workspaces
                if (backupData.workspaces && backupData.workspaces.length > 0) {
                    localStorage.setItem('roadmapWorkspaces', JSON.stringify(backupData.workspaces));
                    log(`âœ… Saved ${backupData.workspaces.length} workspaces to localStorage`, 'success');
                } else {
                    log('âš ï¸  No workspaces in backup', 'warning');
                }

                // Import features WITH timeline items preserved
                if (backupData.features && backupData.features.length > 0) {
                    localStorage.setItem('roadmapFeatures', JSON.stringify(backupData.features));
                    log(`âœ… Saved ${backupData.features.length} features to localStorage`, 'success');

                    // Verify timeline items were saved
                    const savedFeatures = JSON.parse(localStorage.getItem('roadmapFeatures'));
                    let timelineCount = 0;
                    savedFeatures.forEach(f => {
                        if (f.timelineItems) timelineCount += f.timelineItems.length;
                    });
                    log(`âœ… Verified: ${timelineCount} timeline items saved`, 'success');
                } else {
                    log('âŒ No features in backup', 'error');
                    return;
                }

                // Set current workspace
                if (backupData.currentWorkspaceId) {
                    localStorage.setItem('currentWorkspaceId', backupData.currentWorkspaceId);
                    log(`âœ… Set current workspace: ${backupData.currentWorkspaceId}`, 'success');
                } else if (backupData.workspaces && backupData.workspaces.length > 0) {
                    localStorage.setItem('currentWorkspaceId', backupData.workspaces[0].id);
                    log(`âœ… Set current workspace to: ${backupData.workspaces[0].name}`, 'success');
                }

                log('', 'info');
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
                log('âœ… IMPORT COMPLETE!', 'success');
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
                log('', 'info');
                log('Now click "Open Main App" to see your data!', 'info');

            } catch (error) {
                log('âŒ Import failed: ' + error.message, 'error');
                console.error('Import error:', error);
            }
        }

        function openMainApp() {
            window.open('index.html', '_blank');
        }
    </script>
</body>
</html>
