diff --git a/node_modules/@blocksuite/affine-components/CHANGELOG.md b/node_modules/@blocksuite/affine-components/CHANGELOG.md
index e081e3b..eed1a59 100644
--- a/node_modules/@blocksuite/affine-components/CHANGELOG.md
+++ b/node_modules/@blocksuite/affine-components/CHANGELOG.md
@@ -1,5 +1,203 @@
 # @blocksuite/affine-components
 
+## 0.19.5
+
+### Patch Changes
+
+- d2a3eb7: Release patch version.
+
+  ## Feat
+
+  - feat: add telemetry event for drop linked doc (#9028)
+  - feat(blocks): html adapter skip surface block children when doc mode (#9027)
+  - feat(blocks): add markdown adapter for surface elements (#9017)
+
+  ## Fix
+
+  - fix: padding of toggle button (#9024)
+  - fix(blocks): remove lit dependency from theme service (#9025)
+  - fix(blocks): remove lit dependency from theme service (#9023)
+  - fix: keyboard controller should attach event on document (#8801)
+
+  ## Chore
+
+  - chore: use surface block flavour in adapter (#9022)
+  - chore(playground): bump pdf-viewer v0.1.1 (#9020)
+
+- Updated dependencies [d2a3eb7]
+  - @blocksuite/affine-model@0.19.5
+  - @blocksuite/affine-shared@0.19.5
+  - @blocksuite/block-std@0.19.5
+  - @blocksuite/global@0.19.5
+  - @blocksuite/inline@0.19.5
+  - @blocksuite/store@0.19.5
+
+## 0.19.4
+
+### Patch Changes
+
+- 8ae61d6: Improves edgeless viewport stability
+
+  ## Feat
+
+  - feat(database): add AddDatabase event tracking to slash menu (#9015)
+
+  ## Fix
+
+  - fix: should show title alias first (#9005)
+
+  ## Chore
+
+  - chore(blocks): add event tracking for attachment upload (#9008)
+  - chore(blocks): reuse attachment upload method (#9007)
+
+  ## Refactor
+
+  - refactor(std): optimize gfx viewport cache fields (#9014)
+
+  ## Perf
+
+  - perf(edgeless): reduce redundant dom query per render (#9016)
+
+- Updated dependencies [8ae61d6]
+  - @blocksuite/affine-model@0.19.4
+  - @blocksuite/affine-shared@0.19.4
+  - @blocksuite/block-std@0.19.4
+  - @blocksuite/global@0.19.4
+  - @blocksuite/inline@0.19.4
+  - @blocksuite/store@0.19.4
+
+## 0.19.3
+
+### Patch Changes
+
+- 59e0cd6: Release patch version.
+
+  ## Feat
+
+  - feat(edgeless): mind map collapse (#8905)
+  - feat(blocks): add plain text adapter for mind map element (#9006)
+  - feat(edgeless): add views and event support for canvas elements (#8882)
+  - feat(edgeless): improve local element support (#8869)
+
+  ## Fix
+
+  - fix: drag doc from affine to edgeless (#9011)
+  - fix: mind map opacity (#9010)
+  - fix: should only generate new id when cross doc (#9009)
+
+  ## Perf
+
+  - perf(std): add cache for gfx viewport (#9003)
+
+- Updated dependencies [59e0cd6]
+  - @blocksuite/affine-model@0.19.3
+  - @blocksuite/affine-shared@0.19.3
+  - @blocksuite/block-std@0.19.3
+  - @blocksuite/global@0.19.3
+  - @blocksuite/inline@0.19.3
+  - @blocksuite/store@0.19.3
+
+## 0.19.2
+
+### Patch Changes
+
+- bc04f27: ## Feat
+
+  - feat: support heading toggle (#8829)
+  - feat(blocks): add surface element plain text adapter (#8977)
+  - feat: add doc display meta extension (#8953)
+
+  ## Fix
+
+  - fix(blocks): incorrect image icon in keyboard tool panel (#8998)
+  - fix(inline): incorrect caret position in safari when using IME (#8993)
+  - fix(blocks): toolbar color should be light when app theme is light and edgeless theme is dark (#8996)
+  - fix: dnd in edgeless (#8995)
+  - fix: dnd status error (#8994)
+  - fix(blocks): the width of the card view is not fully filled (#8988)
+  - fix(blocks): prevent hiding keyboard when scrolling (#8989)
+
+- Updated dependencies [bc04f27]
+  - @blocksuite/affine-model@0.19.2
+  - @blocksuite/affine-shared@0.19.2
+  - @blocksuite/block-std@0.19.2
+  - @blocksuite/global@0.19.2
+  - @blocksuite/inline@0.19.2
+  - @blocksuite/store@0.19.2
+
+## 0.19.1
+
+### Patch Changes
+
+- ded71c4: chore: release blocksuite
+
+  ## Feat
+
+  - feat(edgeless): release frame by clicking ungroup button (#8984)
+
+  ## Fix
+
+  - fix(edgeless): new inner frame should be inside parent frame (#8985)
+  - fix(inline): range in different document (#8986)
+  - fix(blocks): focus ai input after position updated (#8981)
+  - fix(edgeless): export template job and image upload api (#8980)
+  - fix: preview won't disappear after drag end (#8979)
+  - fix: corner cases of dnd (#8978)
+  - fix(blocks): doc link import/export handling (#8976)
+
+  ## Chore
+
+  - chore(blocks): add image file upload entries to keyboard toolbar (#8987)
+  - chore(blocks): set readonly to database on mobile (#8975)
+  - chore: lock file maintenance (#8983)
+  - chore: lock file maintenance (#8982)
+  - chore: remove legacy versions in transformer and adapter (#8974)
+
+- Updated dependencies [ded71c4]
+  - @blocksuite/affine-model@0.19.1
+  - @blocksuite/affine-shared@0.19.1
+  - @blocksuite/block-std@0.19.1
+  - @blocksuite/global@0.19.1
+  - @blocksuite/inline@0.19.1
+  - @blocksuite/store@0.19.1
+
+## 0.19.0
+
+### Minor Changes
+
+- d7ec057: Blocksuite minor release.
+
+  ## Feat
+
+  - feat: enable new dnd by default (#8970)
+  - feat: should insert bookmark when drop frame and group (#8969)
+  - feat(blocks): add block adapters for note block (#8963)
+
+  ## Fix
+
+  - fix: note dnd preview (#8968)
+  - fix: attachment, bookmark and embed blocks should be draggable (#8967)
+  - fix: should copy embed doc when dnd (#8966)
+  - fix(std): undefined editor during rect polling on mobile (#8965)
+  - fix(blocks): fix incorrect font family in mobile widgets (#8961)
+  - fix(blocks): at menu styles (#8962)
+
+  ## Refactor
+
+  - refactor: optimize code of new drag event watcher (#8971)
+  - refactor(playground): remove `mockPeekViewExtension` (#8964)
+
+### Patch Changes
+
+- Updated dependencies [d7ec057]
+  - @blocksuite/affine-model@0.19.0
+  - @blocksuite/affine-shared@0.19.0
+  - @blocksuite/block-std@0.19.0
+  - @blocksuite/global@0.19.0
+  - @blocksuite/inline@0.19.0
+  - @blocksuite/store@0.19.0
+
 ## 0.18.7
 
 ### Patch Changes
diff --git a/node_modules/@blocksuite/affine-components/dist/context-menu/button.js b/node_modules/@blocksuite/affine-components/dist/context-menu/button.js
index 8d24a87..69c970b 100644
--- a/node_modules/@blocksuite/affine-components/dist/context-menu/button.js
+++ b/node_modules/@blocksuite/affine-components/dist/context-menu/button.js
@@ -33,7 +33,7 @@ var __runInitializers = (this && this.__runInitializers) || function (thisArg, i
     return useValue ? value : void 0;
 };
 import { IS_MOBILE } from '@blocksuite/global/env';
-import { CheckBoxCkeckSolidIcon, CheckBoxUnIcon, DoneIcon, } from '@blocksuite/icons/lit';
+import { CheckBoxCheckSolidIcon, CheckBoxUnIcon, DoneIcon, } from '@blocksuite/icons/lit';
 import { cssVarV2 } from '@toeverything/theme/v2';
 import { css, html, unsafeCSS } from 'lit';
 import { property } from 'lit/decorators.js';
@@ -246,7 +246,7 @@ export const menuButtonItems = {
         const data = {
             content: () => html `
           ${config.checked.value
-                ? CheckBoxCkeckSolidIcon({ style: `color:#1E96EB` })
+                ? CheckBoxCheckSolidIcon({ style: `color:#1E96EB` })
                 : CheckBoxUnIcon()}
           <div class="affine-menu-action-text">
             ${config.label?.() ?? config.name}
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.d.ts.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.d.ts.map
index b01317c..cb7f1ab 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"affine-inline-specs.d.ts","sourceRoot":"","sources":["../../../../src/rich-text/inline/presets/affine-inline-specs.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,oBAAoB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,KAAK,EAAE,YAAY,EAAE,iBAAiB,EAAE,MAAM,oBAAoB,CAAC;AAa1E,MAAM,MAAM,kBAAkB,GAAG,YAAY,CAAC,oBAAoB,CAAC,CAAC;AACpE,MAAM,MAAM,uBAAuB,GAAG,iBAAiB,CAAC,oBAAoB,CAAC,CAAC;AAE9E,eAAO,MAAM,uBAAuB;;CASlC,CAAC;AAEH,eAAO,MAAM,yBAAyB;;CASpC,CAAC;AAEH,eAAO,MAAM,4BAA4B;;CASvC,CAAC;AAEH,eAAO,MAAM,yBAAyB;;CASpC,CAAC;AAEH,eAAO,MAAM,uBAAuB;;CASlC,CAAC;AAEH,eAAO,MAAM,6BAA6B;;CASxC,CAAC;AAEH,eAAO,MAAM,wBAAwB;;CASnC,CAAC;AAEH,eAAO,MAAM,wBAAwB;;CAqBpC,CAAC;AAEF,eAAO,MAAM,4BAA4B;;CAgDxC,CAAC;AAEF,eAAO,MAAM,uBAAuB;;CASlC,CAAC;AAEH,eAAO,MAAM,4BAA4B;;CAOvC,CAAC;AAEH,eAAO,MAAM,oBAAoB;;IAYhC,CAAC"}
\ No newline at end of file
+{"version":3,"file":"affine-inline-specs.d.ts","sourceRoot":"","sources":["../../../../src/rich-text/inline/presets/affine-inline-specs.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,oBAAoB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,KAAK,EAAE,YAAY,EAAE,iBAAiB,EAAE,MAAM,oBAAoB,CAAC;AAa1E,MAAM,MAAM,kBAAkB,GAAG,YAAY,CAAC,oBAAoB,CAAC,CAAC;AACpE,MAAM,MAAM,uBAAuB,GAAG,iBAAiB,CAAC,oBAAoB,CAAC,CAAC;AAE9E,eAAO,MAAM,uBAAuB;;CASlC,CAAC;AAEH,eAAO,MAAM,yBAAyB;;CASpC,CAAC;AAEH,eAAO,MAAM,4BAA4B;;CASvC,CAAC;AAEH,eAAO,MAAM,yBAAyB;;CASpC,CAAC;AAEH,eAAO,MAAM,uBAAuB;;CASlC,CAAC;AAEH,eAAO,MAAM,6BAA6B;;CASxC,CAAC;AAEH,eAAO,MAAM,wBAAwB;;CASnC,CAAC;AAEH,eAAO,MAAM,wBAAwB;;CAqBpC,CAAC;AAEF,eAAO,MAAM,4BAA4B;;CA0CxC,CAAC;AAEF,eAAO,MAAM,uBAAuB;;CASlC,CAAC;AAEH,eAAO,MAAM,4BAA4B;;CAOvC,CAAC;AAEH,eAAO,MAAM,oBAAoB;;IAYhC,CAAC"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js
index 2243ee8..9825de4 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js
@@ -100,12 +100,6 @@ export const ReferenceInlineSpecExtension = InlineSpecExtension('reference', pro
     if (config.customContent) {
         configProvider.setCustomContent(config.customContent);
     }
-    if (config.customIcon) {
-        configProvider.setCustomIcon(config.customIcon);
-    }
-    if (config.customTitle) {
-        configProvider.setCustomTitle(config.customTitle);
-    }
     if (config.interactable !== undefined) {
         configProvider.setInteractable(config.interactable);
     }
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js.map
index cea68b8..4efe277 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/affine-inline-specs.js.map
@@ -1 +1 @@
-{"version":3,"file":"affine-inline-specs.js","sourceRoot":"","sources":["../../../../src/rich-text/inline/presets/affine-inline-specs.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AffineTextAttributes } from '@blocksuite/affine-shared/types';\nimport type { InlineEditor, InlineRootElement } from '@blocksuite/inline';\n\nimport { ReferenceInfoSchema } from '@blocksuite/affine-model';\nimport { StdIdentifier } from '@blocksuite/block-std';\nimport { html } from 'lit';\nimport { z } from 'zod';\n\nimport { InlineSpecExtension } from '../../extension/index.js';\nimport {\n  ReferenceNodeConfigIdentifier,\n  ReferenceNodeConfigProvider,\n} from './nodes/reference-node/reference-config.js';\n\nexport type AffineInlineEditor = InlineEditor<AffineTextAttributes>;\nexport type AffineInlineRootElement = InlineRootElement<AffineTextAttributes>;\n\nexport const BoldInlineSpecExtension = InlineSpecExtension({\n  name: 'bold',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.bold;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const ItalicInlineSpecExtension = InlineSpecExtension({\n  name: 'italic',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.italic;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const UnderlineInlineSpecExtension = InlineSpecExtension({\n  name: 'underline',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.underline;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const StrikeInlineSpecExtension = InlineSpecExtension({\n  name: 'strike',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.strike;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const CodeInlineSpecExtension = InlineSpecExtension({\n  name: 'code',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.code;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const BackgroundInlineSpecExtension = InlineSpecExtension({\n  name: 'background',\n  schema: z.string().optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.background;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const ColorInlineSpecExtension = InlineSpecExtension({\n  name: 'color',\n  schema: z.string().optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.color;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const LatexInlineSpecExtension = InlineSpecExtension(\n  'latex',\n  provider => {\n    const std = provider.get(StdIdentifier);\n    return {\n      name: 'latex',\n      schema: z.string().optional().nullable().catch(undefined),\n      match: delta => typeof delta.attributes?.latex === 'string',\n      renderer: ({ delta, selected, editor, startOffset, endOffset }) => {\n        return html`<affine-latex-node\n          .std=${std}\n          .delta=${delta}\n          .selected=${selected}\n          .editor=${editor}\n          .startOffset=${startOffset}\n          .endOffset=${endOffset}\n        ></affine-latex-node>`;\n      },\n      embed: true,\n    };\n  }\n);\n\nexport const ReferenceInlineSpecExtension = InlineSpecExtension(\n  'reference',\n  provider => {\n    const std = provider.get(StdIdentifier);\n    const configProvider = new ReferenceNodeConfigProvider(std);\n    const config = provider.getOptional(ReferenceNodeConfigIdentifier) ?? {};\n    if (config.customContent) {\n      configProvider.setCustomContent(config.customContent);\n    }\n    if (config.customIcon) {\n      configProvider.setCustomIcon(config.customIcon);\n    }\n    if (config.customTitle) {\n      configProvider.setCustomTitle(config.customTitle);\n    }\n    if (config.interactable !== undefined) {\n      configProvider.setInteractable(config.interactable);\n    }\n    if (config.hidePopup !== undefined) {\n      configProvider.setHidePopup(config.hidePopup);\n    }\n    return {\n      name: 'reference',\n      schema: z\n        .object({\n          type: z.enum([\n            // @deprecated Subpage is deprecated, use LinkedPage instead\n            'Subpage',\n            'LinkedPage',\n          ]),\n        })\n        .merge(ReferenceInfoSchema)\n        .optional()\n        .nullable()\n        .catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.reference;\n      },\n      renderer: ({ delta, selected }) => {\n        return html`<affine-reference\n          .delta=${delta}\n          .selected=${selected}\n          .config=${configProvider}\n        ></affine-reference>`;\n      },\n      embed: true,\n    };\n  }\n);\n\nexport const LinkInlineSpecExtension = InlineSpecExtension({\n  name: 'link',\n  schema: z.string().optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.link;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-link .delta=${delta}></affine-link>`;\n  },\n});\n\nexport const LatexEditorUnitSpecExtension = InlineSpecExtension({\n  name: 'latex-editor-unit',\n  schema: z.undefined(),\n  match: () => true,\n  renderer: ({ delta }) => {\n    return html`<latex-editor-unit .delta=${delta}></latex-editor-unit>`;\n  },\n});\n\nexport const InlineSpecExtensions = [\n  BoldInlineSpecExtension,\n  ItalicInlineSpecExtension,\n  UnderlineInlineSpecExtension,\n  StrikeInlineSpecExtension,\n  CodeInlineSpecExtension,\n  BackgroundInlineSpecExtension,\n  ColorInlineSpecExtension,\n  LatexInlineSpecExtension,\n  ReferenceInlineSpecExtension,\n  LinkInlineSpecExtension,\n  LatexEditorUnitSpecExtension,\n];\n"]}
\ No newline at end of file
+{"version":3,"file":"affine-inline-specs.js","sourceRoot":"","sources":["../../../../src/rich-text/inline/presets/affine-inline-specs.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AffineTextAttributes } from '@blocksuite/affine-shared/types';\nimport type { InlineEditor, InlineRootElement } from '@blocksuite/inline';\n\nimport { ReferenceInfoSchema } from '@blocksuite/affine-model';\nimport { StdIdentifier } from '@blocksuite/block-std';\nimport { html } from 'lit';\nimport { z } from 'zod';\n\nimport { InlineSpecExtension } from '../../extension/index.js';\nimport {\n  ReferenceNodeConfigIdentifier,\n  ReferenceNodeConfigProvider,\n} from './nodes/reference-node/reference-config.js';\n\nexport type AffineInlineEditor = InlineEditor<AffineTextAttributes>;\nexport type AffineInlineRootElement = InlineRootElement<AffineTextAttributes>;\n\nexport const BoldInlineSpecExtension = InlineSpecExtension({\n  name: 'bold',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.bold;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const ItalicInlineSpecExtension = InlineSpecExtension({\n  name: 'italic',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.italic;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const UnderlineInlineSpecExtension = InlineSpecExtension({\n  name: 'underline',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.underline;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const StrikeInlineSpecExtension = InlineSpecExtension({\n  name: 'strike',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.strike;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const CodeInlineSpecExtension = InlineSpecExtension({\n  name: 'code',\n  schema: z.literal(true).optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.code;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const BackgroundInlineSpecExtension = InlineSpecExtension({\n  name: 'background',\n  schema: z.string().optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.background;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const ColorInlineSpecExtension = InlineSpecExtension({\n  name: 'color',\n  schema: z.string().optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.color;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-text .delta=${delta}></affine-text>`;\n  },\n});\n\nexport const LatexInlineSpecExtension = InlineSpecExtension(\n  'latex',\n  provider => {\n    const std = provider.get(StdIdentifier);\n    return {\n      name: 'latex',\n      schema: z.string().optional().nullable().catch(undefined),\n      match: delta => typeof delta.attributes?.latex === 'string',\n      renderer: ({ delta, selected, editor, startOffset, endOffset }) => {\n        return html`<affine-latex-node\n          .std=${std}\n          .delta=${delta}\n          .selected=${selected}\n          .editor=${editor}\n          .startOffset=${startOffset}\n          .endOffset=${endOffset}\n        ></affine-latex-node>`;\n      },\n      embed: true,\n    };\n  }\n);\n\nexport const ReferenceInlineSpecExtension = InlineSpecExtension(\n  'reference',\n  provider => {\n    const std = provider.get(StdIdentifier);\n    const configProvider = new ReferenceNodeConfigProvider(std);\n    const config = provider.getOptional(ReferenceNodeConfigIdentifier) ?? {};\n    if (config.customContent) {\n      configProvider.setCustomContent(config.customContent);\n    }\n    if (config.interactable !== undefined) {\n      configProvider.setInteractable(config.interactable);\n    }\n    if (config.hidePopup !== undefined) {\n      configProvider.setHidePopup(config.hidePopup);\n    }\n    return {\n      name: 'reference',\n      schema: z\n        .object({\n          type: z.enum([\n            // @deprecated Subpage is deprecated, use LinkedPage instead\n            'Subpage',\n            'LinkedPage',\n          ]),\n        })\n        .merge(ReferenceInfoSchema)\n        .optional()\n        .nullable()\n        .catch(undefined),\n      match: delta => {\n        return !!delta.attributes?.reference;\n      },\n      renderer: ({ delta, selected }) => {\n        return html`<affine-reference\n          .delta=${delta}\n          .selected=${selected}\n          .config=${configProvider}\n        ></affine-reference>`;\n      },\n      embed: true,\n    };\n  }\n);\n\nexport const LinkInlineSpecExtension = InlineSpecExtension({\n  name: 'link',\n  schema: z.string().optional().nullable().catch(undefined),\n  match: delta => {\n    return !!delta.attributes?.link;\n  },\n  renderer: ({ delta }) => {\n    return html`<affine-link .delta=${delta}></affine-link>`;\n  },\n});\n\nexport const LatexEditorUnitSpecExtension = InlineSpecExtension({\n  name: 'latex-editor-unit',\n  schema: z.undefined(),\n  match: () => true,\n  renderer: ({ delta }) => {\n    return html`<latex-editor-unit .delta=${delta}></latex-editor-unit>`;\n  },\n});\n\nexport const InlineSpecExtensions = [\n  BoldInlineSpecExtension,\n  ItalicInlineSpecExtension,\n  UnderlineInlineSpecExtension,\n  StrikeInlineSpecExtension,\n  CodeInlineSpecExtension,\n  BackgroundInlineSpecExtension,\n  ColorInlineSpecExtension,\n  LatexInlineSpecExtension,\n  ReferenceInlineSpecExtension,\n  LinkInlineSpecExtension,\n  LatexEditorUnitSpecExtension,\n];\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts
index de8ce64..c4913b1 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts
@@ -3,5 +3,4 @@ export { AffineLink, toggleLinkPopup } from './link-node/index.js';
 export * from './reference-node/reference-config.js';
 export { AffineReference } from './reference-node/reference-node.js';
 export type { RefNodeSlots } from './reference-node/types.js';
-export { cloneReferenceInfo, cloneReferenceInfoWithoutAliases, referenceToNode, } from './reference-node/utils.js';
 //# sourceMappingURL=index.d.ts.map
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts.map
index e5c88bf..364a4ad 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"index.d.ts","sourceRoot":"","sources":["../../../../../src/rich-text/inline/presets/nodes/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,cAAc,EAAE,MAAM,aAAa,CAAC;AAC/D,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,sBAAsB,CAAC;AACnE,cAAc,sCAAsC,CAAC;AAErD,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC;AACrE,YAAY,EAAE,YAAY,EAAE,MAAM,2BAA2B,CAAC;AAC9D,OAAO,EACL,kBAAkB,EAClB,gCAAgC,EAChC,eAAe,GAChB,MAAM,2BAA2B,CAAC"}
\ No newline at end of file
+{"version":3,"file":"index.d.ts","sourceRoot":"","sources":["../../../../../src/rich-text/inline/presets/nodes/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,cAAc,EAAE,MAAM,aAAa,CAAC;AAC/D,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,sBAAsB,CAAC;AACnE,cAAc,sCAAsC,CAAC;AAErD,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC;AACrE,YAAY,EAAE,YAAY,EAAE,MAAM,2BAA2B,CAAC"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js
index c2b99da..e7e2ec3 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js
@@ -2,5 +2,4 @@ export { DEFAULT_DOC_NAME, REFERENCE_NODE } from './consts.js';
 export { AffineLink, toggleLinkPopup } from './link-node/index.js';
 export * from './reference-node/reference-config.js';
 export { AffineReference } from './reference-node/reference-node.js';
-export { cloneReferenceInfo, cloneReferenceInfoWithoutAliases, referenceToNode, } from './reference-node/utils.js';
 //# sourceMappingURL=index.js.map
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js.map
index c0f770a..baa2c27 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/index.js.map
@@ -1 +1 @@
-{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/rich-text/inline/presets/nodes/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,cAAc,EAAE,MAAM,aAAa,CAAC;AAC/D,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,sBAAsB,CAAC;AACnE,cAAc,sCAAsC,CAAC;AAErD,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC;AAErE,OAAO,EACL,kBAAkB,EAClB,gCAAgC,EAChC,eAAe,GAChB,MAAM,2BAA2B,CAAC","sourcesContent":["export { DEFAULT_DOC_NAME, REFERENCE_NODE } from './consts.js';\nexport { AffineLink, toggleLinkPopup } from './link-node/index.js';\nexport * from './reference-node/reference-config.js';\n\nexport { AffineReference } from './reference-node/reference-node.js';\nexport type { RefNodeSlots } from './reference-node/types.js';\nexport {\n  cloneReferenceInfo,\n  cloneReferenceInfoWithoutAliases,\n  referenceToNode,\n} from './reference-node/utils.js';\n"]}
\ No newline at end of file
+{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/rich-text/inline/presets/nodes/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,cAAc,EAAE,MAAM,aAAa,CAAC;AAC/D,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,sBAAsB,CAAC;AACnE,cAAc,sCAAsC,CAAC;AAErD,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC","sourcesContent":["export { DEFAULT_DOC_NAME, REFERENCE_NODE } from './consts.js';\nexport { AffineLink, toggleLinkPopup } from './link-node/index.js';\nexport * from './reference-node/reference-config.js';\n\nexport { AffineReference } from './reference-node/reference-node.js';\nexport type { RefNodeSlots } from './reference-node/types.js';\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts
index 247236e..aa1f369 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts
@@ -2,9 +2,7 @@ import type { BlockStdScope, ExtensionType } from '@blocksuite/block-std';
 import type { TemplateResult } from 'lit';
 import type { AffineReference } from './reference-node.js';
 export interface ReferenceNodeConfig {
-    customContent?: ((reference: AffineReference) => TemplateResult) | null;
-    customIcon?: ((reference: AffineReference) => TemplateResult) | null;
-    customTitle?: ((reference: AffineReference) => string) | null;
+    customContent?: (reference: AffineReference) => TemplateResult;
     interactable?: boolean;
     hidePopup?: boolean;
 }
@@ -13,20 +11,14 @@ export declare function ReferenceNodeConfigExtension(config: ReferenceNodeConfig
 export declare class ReferenceNodeConfigProvider {
     readonly std: BlockStdScope;
     private _customContent;
-    private _customIcon;
-    private _customTitle;
     private _hidePopup;
     private _interactable;
-    get customContent(): ((reference: AffineReference) => TemplateResult) | null;
-    get customIcon(): ((reference: AffineReference) => TemplateResult) | null;
-    get customTitle(): ((reference: AffineReference) => string) | null;
+    get customContent(): ((reference: AffineReference) => TemplateResult) | undefined;
     get doc(): import("@blocksuite/store").Doc;
     get hidePopup(): boolean;
     get interactable(): boolean;
     constructor(std: BlockStdScope);
     setCustomContent(content: ReferenceNodeConfigProvider['_customContent']): void;
-    setCustomIcon(icon: ReferenceNodeConfigProvider['_customIcon']): void;
-    setCustomTitle(title: ReferenceNodeConfigProvider['_customTitle']): void;
     setHidePopup(hidePopup: boolean): void;
     setInteractable(interactable: boolean): void;
 }
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts.map
index 84267c2..80e8dbf 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"reference-config.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-config.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAC;AAC1E,OAAO,KAAK,EAAE,cAAc,EAAE,MAAM,KAAK,CAAC;AAI1C,OAAO,KAAK,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AAE3D,MAAM,WAAW,mBAAmB;IAClC,aAAa,CAAC,EAAE,CAAC,CAAC,SAAS,EAAE,eAAe,KAAK,cAAc,CAAC,GAAG,IAAI,CAAC;IACxE,UAAU,CAAC,EAAE,CAAC,CAAC,SAAS,EAAE,eAAe,KAAK,cAAc,CAAC,GAAG,IAAI,CAAC;IACrE,WAAW,CAAC,EAAE,CAAC,CAAC,SAAS,EAAE,eAAe,KAAK,MAAM,CAAC,GAAG,IAAI,CAAC;IAC9D,YAAY,CAAC,EAAE,OAAO,CAAC;IACvB,SAAS,CAAC,EAAE,OAAO,CAAC;CACrB;AAED,eAAO,MAAM,6BAA6B,gNAC0B,CAAC;AAErE,wBAAgB,4BAA4B,CAC1C,MAAM,EAAE,mBAAmB,GAC1B,aAAa,CAMf;AAED,qBAAa,2BAA2B;IAsC1B,QAAQ,CAAC,GAAG,EAAE,aAAa;IArCvC,OAAO,CAAC,cAAc,CAEN;IAEhB,OAAO,CAAC,WAAW,CACZ;IAEP,OAAO,CAAC,YAAY,CAAyD;IAE7E,OAAO,CAAC,UAAU,CAAS;IAE3B,OAAO,CAAC,aAAa,CAAQ;IAE7B,IAAI,aAAa,iBAZA,eAAe,KAAK,cAAc,SAclD;IAED,IAAI,UAAU,iBAboB,eAAe,KAAK,cAAc,SAenE;IAED,IAAI,WAAW,iBAdoB,eAAe,KAAK,MAAM,SAgB5D;IAED,IAAI,GAAG,oCAEN;IAED,IAAI,SAAS,YAEZ;IAED,IAAI,YAAY,YAEf;gBAEoB,GAAG,EAAE,aAAa;IAEvC,gBAAgB,CAAC,OAAO,EAAE,2BAA2B,CAAC,gBAAgB,CAAC;IAIvE,aAAa,CAAC,IAAI,EAAE,2BAA2B,CAAC,aAAa,CAAC;IAI9D,cAAc,CAAC,KAAK,EAAE,2BAA2B,CAAC,cAAc,CAAC;IAIjE,YAAY,CAAC,SAAS,EAAE,OAAO;IAI/B,eAAe,CAAC,YAAY,EAAE,OAAO;CAGtC"}
\ No newline at end of file
+{"version":3,"file":"reference-config.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-config.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAC;AAC1E,OAAO,KAAK,EAAE,cAAc,EAAE,MAAM,KAAK,CAAC;AAI1C,OAAO,KAAK,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AAE3D,MAAM,WAAW,mBAAmB;IAClC,aAAa,CAAC,EAAE,CAAC,SAAS,EAAE,eAAe,KAAK,cAAc,CAAC;IAC/D,YAAY,CAAC,EAAE,OAAO,CAAC;IACvB,SAAS,CAAC,EAAE,OAAO,CAAC;CACrB;AAED,eAAO,MAAM,6BAA6B,gNAC0B,CAAC;AAErE,wBAAgB,4BAA4B,CAC1C,MAAM,EAAE,mBAAmB,GAC1B,aAAa,CAMf;AAED,qBAAa,2BAA2B;IAyB1B,QAAQ,CAAC,GAAG,EAAE,aAAa;IAxBvC,OAAO,CAAC,cAAc,CAEI;IAE1B,OAAO,CAAC,UAAU,CAAS;IAE3B,OAAO,CAAC,aAAa,CAAQ;IAE7B,IAAI,aAAa,iBAPA,eAAe,KAAK,cAAc,cASlD;IAED,IAAI,GAAG,oCAEN;IAED,IAAI,SAAS,YAEZ;IAED,IAAI,YAAY,YAEf;gBAEoB,GAAG,EAAE,aAAa;IAEvC,gBAAgB,CAAC,OAAO,EAAE,2BAA2B,CAAC,gBAAgB,CAAC;IAIvE,YAAY,CAAC,SAAS,EAAE,OAAO;IAI/B,eAAe,CAAC,YAAY,EAAE,OAAO;CAGtC"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js
index 6cbaed0..5cd56db 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js
@@ -11,12 +11,6 @@ export class ReferenceNodeConfigProvider {
     get customContent() {
         return this._customContent;
     }
-    get customIcon() {
-        return this._customIcon;
-    }
-    get customTitle() {
-        return this._customTitle;
-    }
     get doc() {
         return this.std.doc;
     }
@@ -28,21 +22,13 @@ export class ReferenceNodeConfigProvider {
     }
     constructor(std) {
         this.std = std;
-        this._customContent = null;
-        this._customIcon = null;
-        this._customTitle = null;
+        this._customContent = undefined;
         this._hidePopup = false;
         this._interactable = true;
     }
     setCustomContent(content) {
         this._customContent = content;
     }
-    setCustomIcon(icon) {
-        this._customIcon = icon;
-    }
-    setCustomTitle(title) {
-        this._customTitle = title;
-    }
     setHidePopup(hidePopup) {
         this._hidePopup = hidePopup;
     }
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js.map
index 0535bab..560f22d 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-config.js.map
@@ -1 +1 @@
-{"version":3,"file":"reference-config.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-config.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,gBAAgB,EAAE,MAAM,uBAAuB,CAAC;AAYzD,MAAM,CAAC,MAAM,6BAA6B,GACxC,gBAAgB,CAAsB,2BAA2B,CAAC,CAAC;AAErE,MAAM,UAAU,4BAA4B,CAC1C,MAA2B;IAE3B,OAAO;QACL,KAAK,EAAE,EAAE,CAAC,EAAE;YACV,EAAE,CAAC,OAAO,CAAC,6BAA6B,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;QACnE,CAAC;KACF,CAAC;AACJ,CAAC;AAED,MAAM,OAAO,2BAA2B;IActC,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC;IAED,IAAI,UAAU;QACZ,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;IAED,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;IACtB,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAED,YAAqB,GAAkB;QAAlB,QAAG,GAAH,GAAG,CAAe;QArC/B,mBAAc,GAEX,IAAI,CAAC;QAER,gBAAW,GACjB,IAAI,CAAC;QAEC,iBAAY,GAAoD,IAAI,CAAC;QAErE,eAAU,GAAG,KAAK,CAAC;QAEnB,kBAAa,GAAG,IAAI,CAAC;IA0Ba,CAAC;IAE3C,gBAAgB,CAAC,OAAsD;QACrE,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;IAChC,CAAC;IAED,aAAa,CAAC,IAAgD;QAC5D,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;IAC1B,CAAC;IAED,cAAc,CAAC,KAAkD;QAC/D,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;IAC5B,CAAC;IAED,YAAY,CAAC,SAAkB;QAC7B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;IAC9B,CAAC;IAED,eAAe,CAAC,YAAqB;QACnC,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;IACpC,CAAC;CACF","sourcesContent":["import type { BlockStdScope, ExtensionType } from '@blocksuite/block-std';\nimport type { TemplateResult } from 'lit';\n\nimport { createIdentifier } from '@blocksuite/global/di';\n\nimport type { AffineReference } from './reference-node.js';\n\nexport interface ReferenceNodeConfig {\n  customContent?: ((reference: AffineReference) => TemplateResult) | null;\n  customIcon?: ((reference: AffineReference) => TemplateResult) | null;\n  customTitle?: ((reference: AffineReference) => string) | null;\n  interactable?: boolean;\n  hidePopup?: boolean;\n}\n\nexport const ReferenceNodeConfigIdentifier =\n  createIdentifier<ReferenceNodeConfig>('AffineReferenceNodeConfig');\n\nexport function ReferenceNodeConfigExtension(\n  config: ReferenceNodeConfig\n): ExtensionType {\n  return {\n    setup: di => {\n      di.addImpl(ReferenceNodeConfigIdentifier, () => ({ ...config }));\n    },\n  };\n}\n\nexport class ReferenceNodeConfigProvider {\n  private _customContent:\n    | ((reference: AffineReference) => TemplateResult)\n    | null = null;\n\n  private _customIcon: ((reference: AffineReference) => TemplateResult) | null =\n    null;\n\n  private _customTitle: ((reference: AffineReference) => string) | null = null;\n\n  private _hidePopup = false;\n\n  private _interactable = true;\n\n  get customContent() {\n    return this._customContent;\n  }\n\n  get customIcon() {\n    return this._customIcon;\n  }\n\n  get customTitle() {\n    return this._customTitle;\n  }\n\n  get doc() {\n    return this.std.doc;\n  }\n\n  get hidePopup() {\n    return this._hidePopup;\n  }\n\n  get interactable() {\n    return this._interactable;\n  }\n\n  constructor(readonly std: BlockStdScope) {}\n\n  setCustomContent(content: ReferenceNodeConfigProvider['_customContent']) {\n    this._customContent = content;\n  }\n\n  setCustomIcon(icon: ReferenceNodeConfigProvider['_customIcon']) {\n    this._customIcon = icon;\n  }\n\n  setCustomTitle(title: ReferenceNodeConfigProvider['_customTitle']) {\n    this._customTitle = title;\n  }\n\n  setHidePopup(hidePopup: boolean) {\n    this._hidePopup = hidePopup;\n  }\n\n  setInteractable(interactable: boolean) {\n    this._interactable = interactable;\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"reference-config.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-config.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,gBAAgB,EAAE,MAAM,uBAAuB,CAAC;AAUzD,MAAM,CAAC,MAAM,6BAA6B,GACxC,gBAAgB,CAAsB,2BAA2B,CAAC,CAAC;AAErE,MAAM,UAAU,4BAA4B,CAC1C,MAA2B;IAE3B,OAAO;QACL,KAAK,EAAE,EAAE,CAAC,EAAE;YACV,EAAE,CAAC,OAAO,CAAC,6BAA6B,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,GAAG,MAAM,EAAE,CAAC,CAAC,CAAC;QACnE,CAAC;KACF,CAAC;AACJ,CAAC;AAED,MAAM,OAAO,2BAA2B;IAStC,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;IACtB,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAED,YAAqB,GAAkB;QAAlB,QAAG,GAAH,GAAG,CAAe;QAxB/B,mBAAc,GAEN,SAAS,CAAC;QAElB,eAAU,GAAG,KAAK,CAAC;QAEnB,kBAAa,GAAG,IAAI,CAAC;IAkBa,CAAC;IAE3C,gBAAgB,CAAC,OAAsD;QACrE,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;IAChC,CAAC;IAED,YAAY,CAAC,SAAkB;QAC7B,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;IAC9B,CAAC;IAED,eAAe,CAAC,YAAqB;QACnC,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;IACpC,CAAC;CACF","sourcesContent":["import type { BlockStdScope, ExtensionType } from '@blocksuite/block-std';\nimport type { TemplateResult } from 'lit';\n\nimport { createIdentifier } from '@blocksuite/global/di';\n\nimport type { AffineReference } from './reference-node.js';\n\nexport interface ReferenceNodeConfig {\n  customContent?: (reference: AffineReference) => TemplateResult;\n  interactable?: boolean;\n  hidePopup?: boolean;\n}\n\nexport const ReferenceNodeConfigIdentifier =\n  createIdentifier<ReferenceNodeConfig>('AffineReferenceNodeConfig');\n\nexport function ReferenceNodeConfigExtension(\n  config: ReferenceNodeConfig\n): ExtensionType {\n  return {\n    setup: di => {\n      di.addImpl(ReferenceNodeConfigIdentifier, () => ({ ...config }));\n    },\n  };\n}\n\nexport class ReferenceNodeConfigProvider {\n  private _customContent:\n    | ((reference: AffineReference) => TemplateResult)\n    | undefined = undefined;\n\n  private _hidePopup = false;\n\n  private _interactable = true;\n\n  get customContent() {\n    return this._customContent;\n  }\n\n  get doc() {\n    return this.std.doc;\n  }\n\n  get hidePopup() {\n    return this._hidePopup;\n  }\n\n  get interactable() {\n    return this._interactable;\n  }\n\n  constructor(readonly std: BlockStdScope) {}\n\n  setCustomContent(content: ReferenceNodeConfigProvider['_customContent']) {\n    this._customContent = content;\n  }\n\n  setHidePopup(hidePopup: boolean) {\n    this._hidePopup = hidePopup;\n  }\n\n  setInteractable(interactable: boolean) {\n    this._interactable = interactable;\n  }\n}\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts
index d6895a0..bce1bdd 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts
@@ -11,10 +11,10 @@ export declare class AffineReference extends AffineReference_base {
     private _updateRefMeta;
     accessor refMeta: DocMeta | undefined;
     private _whenHover;
+    get _icon(): import("lit-html").TemplateResult | undefined;
+    get _title(): string | undefined;
     get block(): BlockComponent<import("@blocksuite/store").BlockModel<object, object & {}>, import("@blocksuite/block-std").BlockService, string> | null | undefined;
-    get customContent(): ((reference: AffineReference) => import("lit-html").TemplateResult) | null;
-    get customIcon(): ((reference: AffineReference) => import("lit-html").TemplateResult) | null;
-    get customTitle(): ((reference: AffineReference) => string) | null;
+    get customContent(): ((reference: AffineReference) => import("lit-html").TemplateResult) | undefined;
     get doc(): Doc;
     get inlineEditor(): import("@blocksuite/inline").InlineEditor<AffineTextAttributes> | undefined;
     get referenceInfo(): ReferenceInfo;
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts.map
index c9b2891..8a7edce 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"reference-node.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-node.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AAC9D,OAAO,KAAK,EAAE,oBAAoB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,KAAK,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,mBAAmB,CAAC;AAEtD,OAAO,EAEL,KAAK,cAAc,EACnB,iBAAiB,EAClB,MAAM,uBAAuB,CAAC;AAI/B,OAAO,EACL,KAAK,WAAW,EAKjB,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAa,OAAO,EAAE,MAAM,KAAK,CAAC;AAMzC,OAAO,KAAK,EAAE,2BAA2B,EAAE,MAAM,uBAAuB,CAAC;;AAezE,qBACa,eAAgB,SAAQ,oBAAiC;IACpE,OAAgB,MAAM,0BA4BpB;IAEF,OAAO,CAAC,cAAc,CAcpB;IAIF,QAAQ,CAAC,OAAO,EAAE,OAAO,GAAG,SAAS,CAAa;IAElD,OAAO,CAAC,UAAU,CAwChB;IAEF,IAAI,KAAK,yJAKR;IAED,IAAI,aAAa,+EAEhB;IAED,IAAI,UAAU,+EAEb;IAED,IAAI,WAAW,oDAEd;IAED,IAAI,GAAG,QAGN;IAED,IAAI,YAAY,gFAKf;IAED,IAAI,aAAa,IAAI,aAAa,CAKjC;IAED,IAAI,eAAe,gEAGlB;IAED,IAAI,GAAG,kDASN;IAED,OAAO,CAAC,QAAQ;IAOP,iBAAiB;IAkC1B,eAAe;IAIN,MAAM;IAkEN,UAAU,CAAC,kBAAkB,EAAE,GAAG,CAAC,WAAW,EAAE,OAAO,CAAC;IAUjE,QAAQ,CAAC,MAAM,EAAG,2BAA2B,CAAC;IAG9C,QAAQ,CAAC,KAAK,EAAE,WAAW,CAAC,oBAAoB,CAAC,CAG/C;IAGF,QAAQ,CAAC,QAAQ,UAAS;CAC3B"}
\ No newline at end of file
+{"version":3,"file":"reference-node.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-node.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AAC9D,OAAO,KAAK,EAAE,oBAAoB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,KAAK,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,mBAAmB,CAAC;AAOtD,OAAO,EAEL,KAAK,cAAc,EACnB,iBAAiB,EAClB,MAAM,uBAAuB,CAAC;AAI/B,OAAO,EACL,KAAK,WAAW,EAKjB,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAa,OAAO,EAAE,MAAM,KAAK,CAAC;AAOzC,OAAO,KAAK,EAAE,2BAA2B,EAAE,MAAM,uBAAuB,CAAC;;AASzE,qBACa,eAAgB,SAAQ,oBAAiC;IACpE,OAAgB,MAAM,0BA4BpB;IAEF,OAAO,CAAC,cAAc,CAcpB;IAIF,QAAQ,CAAC,OAAO,EAAE,OAAO,GAAG,SAAS,CAAa;IAElD,OAAO,CAAC,UAAU,CAwChB;IAEF,IAAI,KAAK,kDAKR;IAED,IAAI,MAAM,uBAQT;IAED,IAAI,KAAK,yJAKR;IAED,IAAI,aAAa,oFAEhB;IAED,IAAI,GAAG,QAGN;IAED,IAAI,YAAY,gFAKf;IAED,IAAI,aAAa,IAAI,aAAa,CAKjC;IAED,IAAI,eAAe,gEAGlB;IAED,IAAI,GAAG,kDASN;IAED,OAAO,CAAC,QAAQ;IAOP,iBAAiB;IAkC1B,eAAe;IAIN,MAAM;IAyDN,UAAU,CAAC,kBAAkB,EAAE,GAAG,CAAC,WAAW,EAAE,OAAO,CAAC;IAUjE,QAAQ,CAAC,MAAM,EAAG,2BAA2B,CAAC;IAG9C,QAAQ,CAAC,KAAK,EAAE,WAAW,CAAC,oBAAoB,CAAC,CAG/C;IAGF,QAAQ,CAAC,QAAQ,UAAS;CAC3B"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js
index 89c0803..9e0feaa 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js
@@ -32,24 +32,25 @@ var __runInitializers = (this && this.__runInitializers) || function (thisArg, i
     }
     return useValue ? value : void 0;
 };
+import { DocDisplayMetaProvider } from '@blocksuite/affine-shared/services';
+import { cloneReferenceInfo, referenceToNode, } from '@blocksuite/affine-shared/utils';
 import { BLOCK_ID_ATTR, ShadowlessElement, } from '@blocksuite/block-std';
 import { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';
 import { WithDisposable } from '@blocksuite/global/utils';
-import { AliasIcon } from '@blocksuite/icons/lit';
+import { LinkedPageIcon } from '@blocksuite/icons/lit';
 import { INLINE_ROOT_ATTR, ZERO_WIDTH_NON_JOINER, ZERO_WIDTH_SPACE, } from '@blocksuite/inline';
 import { css, html, nothing } from 'lit';
 import { property, state } from 'lit/decorators.js';
 import { choose } from 'lit/directives/choose.js';
+import { ifDefined } from 'lit/directives/if-defined.js';
 import { ref } from 'lit/directives/ref.js';
 import { styleMap } from 'lit/directives/style-map.js';
 import { HoverController } from '../../../../../hover/index.js';
-import { BlockLinkIcon, FontDocIcon, FontLinkedDocIcon, } from '../../../../../icons/index.js';
 import { Peekable } from '../../../../../peek/index.js';
 import { RefNodeSlotsProvider } from '../../../../extension/index.js';
 import { affineTextStyles } from '../affine-text.js';
 import { DEFAULT_DOC_NAME, REFERENCE_NODE } from '../consts.js';
 import { toggleReferencePopup } from './reference-popup.js';
-import { cloneReferenceInfo, referenceToNode } from './utils.js';
 let AffineReference = (() => {
     let _classDecorators = [Peekable({ action: false })];
     let _classDescriptor;
@@ -117,6 +118,19 @@ let AffineReference = (() => {
         // Since the linked doc may be deleted, the `_refMeta` could be undefined.
         get refMeta() { return this.#refMeta_accessor_storage; }
         set refMeta(value) { this.#refMeta_accessor_storage = value; }
+        get _icon() {
+            const { pageId, params, title } = this.referenceInfo;
+            return this.block?.std
+                ?.get(DocDisplayMetaProvider)
+                .icon(pageId, { params, title, referenced: true }).value;
+        }
+        get _title() {
+            const { pageId, params, title } = this.referenceInfo;
+            return (title ||
+                this.block?.std
+                    ?.get(DocDisplayMetaProvider)
+                    .title(pageId, { params, title, referenced: true }).value);
+        }
         get block() {
             const block = this.inlineEditor?.rootElement.closest(`[${BLOCK_ID_ATTR}]`);
             return block;
@@ -124,12 +138,6 @@ let AffineReference = (() => {
         get customContent() {
             return this.config.customContent;
         }
-        get customIcon() {
-            return this.config.customIcon;
-        }
-        get customTitle() {
-            return this.config.customTitle;
-        }
         get doc() {
             const doc = this.config.doc;
             return doc;
@@ -198,23 +206,18 @@ let AffineReference = (() => {
             if (!attributes || !type) {
                 return nothing;
             }
-            const hasTitleAlias = Boolean(reference?.title && reference.title.length > 0);
-            const title = this.customTitle
-                ? this.customTitle(this)
-                : isDeleted
-                    ? 'Deleted doc'
-                    : reference?.title || refMeta.title || DEFAULT_DOC_NAME;
+            const title = this._title;
             const icon = choose(type, [
+                ['LinkedPage', () => this._icon],
                 [
-                    'LinkedPage',
-                    () => hasTitleAlias
-                        ? AliasIcon()
-                        : this.referenceToNode()
-                            ? BlockLinkIcon
-                            : FontLinkedDocIcon,
+                    'Subpage',
+                    () => LinkedPageIcon({
+                        width: '1.25em',
+                        height: '1.25em',
+                        style: 'user-select:none;flex-shrink:0;vertical-align:middle;font-size:inherit;margin-bottom:0.1em;',
+                    }),
                 ],
-                ['Subpage', () => FontDocIcon],
-            ], () => this.customIcon?.(this) ?? nothing);
+            ]);
             const style = affineTextStyles(attributes, isDeleted
                 ? {
                     color: 'var(--affine-text-disable-color)',
@@ -224,7 +227,9 @@ let AffineReference = (() => {
                 : {});
             const content = this.customContent
                 ? this.customContent(this)
-                : html `${icon}<span data-title=${title} class="affine-reference-title"
+                : html `${icon}<span
+            data-title=${ifDefined(title)}
+            class="affine-reference-title"
             >${title}</span
           >`;
             // we need to add `<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text>` in an
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js.map
index 2c48dd0..83152ba 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-node.js.map
@@ -1 +1 @@
-{"version":3,"file":"reference-node.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-node.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,OAAO,EACL,aAAa,EAEb,iBAAiB,GAClB,MAAM,uBAAuB,CAAC;AAC/B,OAAO,EAAE,eAAe,EAAE,SAAS,EAAE,MAAM,+BAA+B,CAAC;AAC3E,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AAC1D,OAAO,EAAE,SAAS,EAAE,MAAM,uBAAuB,CAAC;AAClD,OAAO,EAEL,gBAAgB,EAEhB,qBAAqB,EACrB,gBAAgB,GACjB,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AACpD,OAAO,EAAE,MAAM,EAAE,MAAM,0BAA0B,CAAC;AAClD,OAAO,EAAE,GAAG,EAAE,MAAM,uBAAuB,CAAC;AAC5C,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AAIvD,OAAO,EAAE,eAAe,EAAE,MAAM,+BAA+B,CAAC;AAChE,OAAO,EACL,aAAa,EACb,WAAW,EACX,iBAAiB,GAClB,MAAM,+BAA+B,CAAC;AACvC,OAAO,EAAE,QAAQ,EAAE,MAAM,8BAA8B,CAAC;AACxD,OAAO,EAAE,oBAAoB,EAAE,MAAM,gCAAgC,CAAC;AACtE,OAAO,EAAE,gBAAgB,EAAE,MAAM,mBAAmB,CAAC;AACrD,OAAO,EAAE,gBAAgB,EAAE,cAAc,EAAE,MAAM,cAAc,CAAC;AAChE,OAAO,EAAE,oBAAoB,EAAE,MAAM,sBAAsB,CAAC;AAC5D,OAAO,EAAE,kBAAkB,EAAE,eAAe,EAAE,MAAM,YAAY,CAAC;IAGpD,eAAe;4BAD3B,QAAQ,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;;;;sBACS,cAAc,CAAC,iBAAiB,CAAC;;;;;;;;;;;;;+BAAzC,SAAQ,WAAiC;;;;mCAgDnE,KAAK,EAAE;kCA2NP,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;iCAG9B,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;oCAM1B,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;YAnO5B,0KAAS,OAAO,6BAAP,OAAO,yFAAkC;YA2NlD,uKAAS,MAAM,6BAAN,MAAM,uFAA+B;YAG9C,oKAAS,KAAK,6BAAL,KAAK,qFAGZ;YAGF,6KAAS,QAAQ,6BAAR,QAAQ,2FAAS;YArR5B,6KAsRC;;;;iBArRiB,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4B3B,AA5BqB,CA4BpB;QAoBF,0BAAkD;QAFlD,0EAA0E;QAE1E,IAAS,OAAO,6CAAkC;QAAlD,IAAS,OAAO,mDAAkC;QA4ClD,IAAI,KAAK;YACP,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,EAAE,WAAW,CAAC,OAAO,CAClD,IAAI,aAAa,GAAG,CACrB,CAAC;YACF,OAAO,KAAK,CAAC;QACf,CAAC;QAED,IAAI,aAAa;YACf,OAAO,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC;QACnC,CAAC;QAED,IAAI,UAAU;YACZ,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;QAChC,CAAC;QAED,IAAI,WAAW;YACb,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC;QACjC,CAAC;QAED,IAAI,GAAG;YACL,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;YAC5B,OAAO,GAAG,CAAC;QACb,CAAC;QAED,IAAI,YAAY;YACd,MAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAC7B,IAAI,gBAAgB,GAAG,CACxB,CAAC;YACF,OAAO,UAAU,EAAE,YAAY,CAAC;QAClC,CAAC;QAED,IAAI,aAAa;YACf,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,SAAS,CAAC;YACnD,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC;YAC9B,IAAI,CAAC,SAAS;gBAAE,OAAO,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC;YACtC,OAAO,kBAAkB,CAAC,SAAS,CAAC,CAAC;QACvC,CAAC;QAED,IAAI,eAAe;YACjB,MAAM,eAAe,GAAG,IAAI,CAAC,YAAY,EAAE,yBAAyB,CAAC,IAAI,CAAC,CAAC;YAC3E,OAAO,eAAe,CAAC;QACzB,CAAC;QAED,IAAI,GAAG;YACL,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC;YAC5B,IAAI,CAAC,GAAG,EAAE,CAAC;gBACT,MAAM,IAAI,eAAe,CACvB,SAAS,CAAC,cAAc,EACxB,iCAAiC,CAClC,CAAC;YACJ,CAAC;YACD,OAAO,GAAG,CAAC;QACb,CAAC;QAEO,QAAQ;YACd,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY;gBAAE,OAAO;YACtC,IAAI,CAAC,GAAG;iBACL,WAAW,CAAC,oBAAoB,CAAC;gBAClC,EAAE,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC9C,CAAC;QAEQ,iBAAiB;YACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAE1B,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;gBACjB,OAAO,CAAC,KAAK,CAAC,8CAA8C,CAAC,CAAC;gBAC9D,OAAO;YACT,CAAC;YAED,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,cAAc,EAAE,CAAC;gBACzC,OAAO,CAAC,KAAK,CACX,4CAA4C,cAAc,eAAe,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAC9F,CAAC;YACJ,CAAC;YAED,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;YACrB,IAAI,GAAG,EAAE,CAAC;gBACR,IAAI,CAAC,YAAY,CAAC,GAAG,CACnB,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CACnE,CAAC;YACJ,CAAC;YAED,IAAI,CAAC,cAAc;iBAChB,IAAI,CAAC,GAAG,EAAE;gBACT,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,GAAG;oBAAE,OAAO;gBAEvC,uBAAuB;gBACvB,IAAI,CAAC,WAAW,CAAC,GAAG,CAClB,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,UAAU,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CACtE,CAAC;YACJ,CAAC,CAAC;iBACD,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC1B,CAAC;QAED,6BAA6B;QAC7B,eAAe;YACb,OAAO,eAAe,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC7C,CAAC;QAEQ,MAAM;YACb,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;YAC7B,MAAM,SAAS,GAAG,CAAC,OAAO,CAAC;YAE3B,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;YACzC,MAAM,SAAS,GAAG,UAAU,EAAE,SAAS,CAAC;YACxC,MAAM,IAAI,GAAG,SAAS,EAAE,IAAI,CAAC;YAC7B,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,EAAE,CAAC;gBACzB,OAAO,OAAO,CAAC;YACjB,CAAC;YAED,MAAM,aAAa,GAAG,OAAO,CAC3B,SAAS,EAAE,KAAK,IAAI,SAAS,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAC/C,CAAC;YACF,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW;gBAC5B,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;gBACxB,CAAC,CAAC,SAAS;oBACT,CAAC,CAAC,aAAa;oBACf,CAAC,CAAC,SAAS,EAAE,KAAK,IAAI,OAAO,CAAC,KAAK,IAAI,gBAAgB,CAAC;YAE5D,MAAM,IAAI,GAAG,MAAM,CACjB,IAAI,EACJ;gBACE;oBACE,YAAY;oBACZ,GAAG,EAAE,CACH,aAAa;wBACX,CAAC,CAAC,SAAS,EAAE;wBACb,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE;4BACtB,CAAC,CAAC,aAAa;4BACf,CAAC,CAAC,iBAAiB;iBAC1B;gBACD,CAAC,SAAS,EAAE,GAAG,EAAE,CAAC,WAAW,CAAC;aAC/B,EACD,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC,IAAI,OAAO,CACzC,CAAC;YAEF,MAAM,KAAK,GAAG,gBAAgB,CAC5B,UAAU,EACV,SAAS;gBACP,CAAC,CAAC;oBACE,KAAK,EAAE,kCAAkC;oBACzC,cAAc,EAAE,cAAc;oBAC9B,IAAI,EAAE,kCAAkC;iBACzC;gBACH,CAAC,CAAC,EAAE,CACP,CAAC;YAEF,MAAM,OAAO,GAAG,IAAI,CAAC,aAAa;gBAChC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;gBAC1B,CAAC,CAAC,IAAI,CAAA,GAAG,IAAI,oBAAoB,KAAK;eAC7B,KAAK;YACR,CAAC;YAET,yEAAyE;YACzE,iEAAiE;YACjE,OAAO,IAAI,CAAA;QACP,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE;sBACnD,IAAI,CAAC,QAAQ;;cAErB,QAAQ,CAAC,KAAK,CAAC;eACd,IAAI,CAAC,QAAQ;SACnB,OAAO,gBAAgB,qBAAqB;aACxC,CAAC;QACZ,CAAC;QAEQ,UAAU,CAAC,kBAA6C;YAC/D,KAAK,CAAC,UAAU,CAAC,kBAAkB,CAAC,CAAC;YAErC,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;YACrB,IAAI,GAAG,EAAE,CAAC;gBACR,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;YAC3B,CAAC;QACH,CAAC;QAGD,yBAA8C;QAA9C,IAAS,MAAM,4CAA+B;QAA9C,IAAS,MAAM,kDAA+B;QAG9C,wBAGE;QAHF,IAAS,KAAK,2CAGZ;QAHF,IAAS,KAAK,iDAGZ;QAGF,2BAA0B;QAA1B,IAAS,QAAQ,8CAAS;QAA1B,IAAS,QAAQ,oDAAS;;;YAtPlB,mBAAc,GAAG,CAAC,GAAQ,EAAE,EAAE;gBACpC,MAAM,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,SAAS,CAAC;gBACtD,IAAI,CAAC,YAAY,EAAE,CAAC;oBAClB,OAAO;gBACT,CAAC;gBAED,MAAM,OAAO,GAAG,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAC/C,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,KAAK,YAAY,CAAC,MAAM,CACtC,CAAC;gBACF,IAAI,CAAC,OAAO,GAAG,OAAO;oBACpB,CAAC,CAAC;wBACE,GAAG,OAAO;qBACX;oBACH,CAAC,CAAC,SAAS,CAAC;YAChB,CAAC,CAAC;YAIO,gFAA+B,SAAS,EAAC;YAE1C,eAAU,yDAAoB,IAAI,eAAe,CACvD,IAAI,EACJ,CAAC,EAAE,eAAe,EAAE,EAAE,EAAE;gBACtB,IACE,IAAI,CAAC,MAAM,CAAC,SAAS;oBACrB,IAAI,CAAC,GAAG,EAAE,QAAQ;oBAClB,IAAI,CAAC,OAAO,CAAC,0BAA0B,CAAC;oBACxC,CAAC,IAAI,CAAC,eAAe;oBACrB,CAAC,IAAI,CAAC,YAAY,EAClB,CAAC;oBACD,OAAO,IAAI,CAAC;gBACd,CAAC;gBAED,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,SAAS,CAAC;gBACtC,IAAI,CAAC,SAAS,EAAE,CAAC;oBACf,OAAO,IAAI,CAAC;gBACd,CAAC;gBACD,MAAM,aAAa,GAAG,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC7C,IAAI,CAAC,CAAC,aAAa,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,EAAE,CAAC;oBACpD,OAAO,IAAI,CAAC;gBACd,CAAC;gBAED,MAAM,eAAe,GAAG,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;gBAClD,IAAI,eAAe,CAAC,MAAM,EAAE,CAAC;oBAC3B,OAAO,IAAI,CAAC;gBACd,CAAC;gBAED,OAAO;oBACL,QAAQ,EAAE,oBAAoB,CAC5B,IAAI,EACJ,IAAI,CAAC,eAAe,EAAE,EACtB,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,OAAO,EAAE,KAAK,IAAI,gBAAgB,EACvC,eAAe,CAChB;iBACF,CAAC;YACJ,CAAC,EACD,EAAE,UAAU,EAAE,GAAG,EAAE,CACpB,EAAC;YAiLO,sFAAqC;YAGrC,iIAA2C;gBAClD,MAAM,EAAE,gBAAgB;gBACxB,UAAU,EAAE,EAAE;aACf,GAAC;YAGO,sIAAW,KAAK,GAAC;;;;YArRf,uDAAe;;;;;SAAf,eAAe","sourcesContent":["import type { ReferenceInfo } from '@blocksuite/affine-model';\nimport type { AffineTextAttributes } from '@blocksuite/affine-shared/types';\nimport type { Doc, DocMeta } from '@blocksuite/store';\n\nimport {\n  BLOCK_ID_ATTR,\n  type BlockComponent,\n  ShadowlessElement,\n} from '@blocksuite/block-std';\nimport { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { AliasIcon } from '@blocksuite/icons/lit';\nimport {\n  type DeltaInsert,\n  INLINE_ROOT_ATTR,\n  type InlineRootElement,\n  ZERO_WIDTH_NON_JOINER,\n  ZERO_WIDTH_SPACE,\n} from '@blocksuite/inline';\nimport { css, html, nothing } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { ref } from 'lit/directives/ref.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ReferenceNodeConfigProvider } from './reference-config.js';\n\nimport { HoverController } from '../../../../../hover/index.js';\nimport {\n  BlockLinkIcon,\n  FontDocIcon,\n  FontLinkedDocIcon,\n} from '../../../../../icons/index.js';\nimport { Peekable } from '../../../../../peek/index.js';\nimport { RefNodeSlotsProvider } from '../../../../extension/index.js';\nimport { affineTextStyles } from '../affine-text.js';\nimport { DEFAULT_DOC_NAME, REFERENCE_NODE } from '../consts.js';\nimport { toggleReferencePopup } from './reference-popup.js';\nimport { cloneReferenceInfo, referenceToNode } from './utils.js';\n\n@Peekable({ action: false })\nexport class AffineReference extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-reference {\n      white-space: normal;\n      word-break: break-word;\n      color: var(--affine-text-primary-color);\n      fill: var(--affine-icon-color);\n      border-radius: 4px;\n      text-decoration: none;\n      cursor: pointer;\n      user-select: none;\n      padding: 1px 2px 1px 0;\n    }\n    .affine-reference:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference[data-selected='true'] {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference-title {\n      margin-left: 4px;\n      border-bottom: 0.5px solid var(--affine-divider-color);\n      transition: border 0.2s ease-out;\n    }\n    .affine-reference-title:hover {\n      border-bottom: 0.5px solid var(--affine-icon-color);\n    }\n  `;\n\n  private _updateRefMeta = (doc: Doc) => {\n    const refAttribute = this.delta.attributes?.reference;\n    if (!refAttribute) {\n      return;\n    }\n\n    const refMeta = doc.collection.meta.docMetas.find(\n      doc => doc.id === refAttribute.pageId\n    );\n    this.refMeta = refMeta\n      ? {\n          ...refMeta,\n        }\n      : undefined;\n  };\n\n  // Since the linked doc may be deleted, the `_refMeta` could be undefined.\n  @state()\n  accessor refMeta: DocMeta | undefined = undefined;\n\n  private _whenHover: HoverController = new HoverController(\n    this,\n    ({ abortController }) => {\n      if (\n        this.config.hidePopup ||\n        this.doc?.readonly ||\n        this.closest('.prevent-reference-popup') ||\n        !this.selfInlineRange ||\n        !this.inlineEditor\n      ) {\n        return null;\n      }\n\n      const selection = this.std?.selection;\n      if (!selection) {\n        return null;\n      }\n      const textSelection = selection.find('text');\n      if (!!textSelection && !textSelection.isCollapsed()) {\n        return null;\n      }\n\n      const blockSelections = selection.filter('block');\n      if (blockSelections.length) {\n        return null;\n      }\n\n      return {\n        template: toggleReferencePopup(\n          this,\n          this.referenceToNode(),\n          this.referenceInfo,\n          this.inlineEditor,\n          this.selfInlineRange,\n          this.refMeta?.title ?? DEFAULT_DOC_NAME,\n          abortController\n        ),\n      };\n    },\n    { enterDelay: 500 }\n  );\n\n  get block() {\n    const block = this.inlineEditor?.rootElement.closest<BlockComponent>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    return block;\n  }\n\n  get customContent() {\n    return this.config.customContent;\n  }\n\n  get customIcon() {\n    return this.config.customIcon;\n  }\n\n  get customTitle() {\n    return this.config.customTitle;\n  }\n\n  get doc() {\n    const doc = this.config.doc;\n    return doc;\n  }\n\n  get inlineEditor() {\n    const inlineRoot = this.closest<InlineRootElement<AffineTextAttributes>>(\n      `[${INLINE_ROOT_ATTR}]`\n    );\n    return inlineRoot?.inlineEditor;\n  }\n\n  get referenceInfo(): ReferenceInfo {\n    const reference = this.delta.attributes?.reference;\n    const id = this.doc?.id ?? '';\n    if (!reference) return { pageId: id };\n    return cloneReferenceInfo(reference);\n  }\n\n  get selfInlineRange() {\n    const selfInlineRange = this.inlineEditor?.getInlineRangeFromElement(this);\n    return selfInlineRange;\n  }\n\n  get std() {\n    const std = this.block?.std;\n    if (!std) {\n      throw new BlockSuiteError(\n        ErrorCode.ValueNotExists,\n        'std not found in reference node'\n      );\n    }\n    return std;\n  }\n\n  private _onClick() {\n    if (!this.config.interactable) return;\n    this.std\n      .getOptional(RefNodeSlotsProvider)\n      ?.docLinkClicked.emit(this.referenceInfo);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.config) {\n      console.error('`reference-node` need `ReferenceNodeConfig`.');\n      return;\n    }\n\n    if (this.delta.insert !== REFERENCE_NODE) {\n      console.error(\n        `Reference node must be initialized with '${REFERENCE_NODE}', but got '${this.delta.insert}'`\n      );\n    }\n\n    const doc = this.doc;\n    if (doc) {\n      this._disposables.add(\n        doc.collection.slots.docUpdated.on(() => this._updateRefMeta(doc))\n      );\n    }\n\n    this.updateComplete\n      .then(() => {\n        if (!this.inlineEditor || !doc) return;\n\n        // observe yText update\n        this.disposables.add(\n          this.inlineEditor.slots.textChange.on(() => this._updateRefMeta(doc))\n        );\n      })\n      .catch(console.error);\n  }\n\n  // reference to block/element\n  referenceToNode() {\n    return referenceToNode(this.referenceInfo);\n  }\n\n  override render() {\n    const refMeta = this.refMeta;\n    const isDeleted = !refMeta;\n\n    const attributes = this.delta.attributes;\n    const reference = attributes?.reference;\n    const type = reference?.type;\n    if (!attributes || !type) {\n      return nothing;\n    }\n\n    const hasTitleAlias = Boolean(\n      reference?.title && reference.title.length > 0\n    );\n    const title = this.customTitle\n      ? this.customTitle(this)\n      : isDeleted\n        ? 'Deleted doc'\n        : reference?.title || refMeta.title || DEFAULT_DOC_NAME;\n\n    const icon = choose(\n      type,\n      [\n        [\n          'LinkedPage',\n          () =>\n            hasTitleAlias\n              ? AliasIcon()\n              : this.referenceToNode()\n                ? BlockLinkIcon\n                : FontLinkedDocIcon,\n        ],\n        ['Subpage', () => FontDocIcon],\n      ],\n      () => this.customIcon?.(this) ?? nothing\n    );\n\n    const style = affineTextStyles(\n      attributes,\n      isDeleted\n        ? {\n            color: 'var(--affine-text-disable-color)',\n            textDecoration: 'line-through',\n            fill: 'var(--affine-text-disable-color)',\n          }\n        : {}\n    );\n\n    const content = this.customContent\n      ? this.customContent(this)\n      : html`${icon}<span data-title=${title} class=\"affine-reference-title\"\n            >${title}</span\n          >`;\n\n    // we need to add `<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text>` in an\n    // embed element to make sure inline range calculation is correct\n    return html`<span\n      ${this.config.interactable ? ref(this._whenHover.setReference) : ''}\n      data-selected=${this.selected}\n      class=\"affine-reference\"\n      style=${styleMap(style)}\n      @click=${this._onClick}\n      >${content}<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text\n    ></span>`;\n  }\n\n  override willUpdate(_changedProperties: Map<PropertyKey, unknown>) {\n    super.willUpdate(_changedProperties);\n\n    const doc = this.doc;\n    if (doc) {\n      this._updateRefMeta(doc);\n    }\n  }\n\n  @property({ attribute: false })\n  accessor config!: ReferenceNodeConfigProvider;\n\n  @property({ type: Object })\n  accessor delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n    attributes: {},\n  };\n\n  @property({ type: Boolean })\n  accessor selected = false;\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"reference-node.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-node.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReferenceInfo } from '@blocksuite/affine-model';\nimport type { AffineTextAttributes } from '@blocksuite/affine-shared/types';\nimport type { Doc, DocMeta } from '@blocksuite/store';\n\nimport { DocDisplayMetaProvider } from '@blocksuite/affine-shared/services';\nimport {\n  cloneReferenceInfo,\n  referenceToNode,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  BLOCK_ID_ATTR,\n  type BlockComponent,\n  ShadowlessElement,\n} from '@blocksuite/block-std';\nimport { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { LinkedPageIcon } from '@blocksuite/icons/lit';\nimport {\n  type DeltaInsert,\n  INLINE_ROOT_ATTR,\n  type InlineRootElement,\n  ZERO_WIDTH_NON_JOINER,\n  ZERO_WIDTH_SPACE,\n} from '@blocksuite/inline';\nimport { css, html, nothing } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { ref } from 'lit/directives/ref.js';\nimport { styleMap } from 'lit/directives/style-map.js';\n\nimport type { ReferenceNodeConfigProvider } from './reference-config.js';\n\nimport { HoverController } from '../../../../../hover/index.js';\nimport { Peekable } from '../../../../../peek/index.js';\nimport { RefNodeSlotsProvider } from '../../../../extension/index.js';\nimport { affineTextStyles } from '../affine-text.js';\nimport { DEFAULT_DOC_NAME, REFERENCE_NODE } from '../consts.js';\nimport { toggleReferencePopup } from './reference-popup.js';\n\n@Peekable({ action: false })\nexport class AffineReference extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .affine-reference {\n      white-space: normal;\n      word-break: break-word;\n      color: var(--affine-text-primary-color);\n      fill: var(--affine-icon-color);\n      border-radius: 4px;\n      text-decoration: none;\n      cursor: pointer;\n      user-select: none;\n      padding: 1px 2px 1px 0;\n    }\n    .affine-reference:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference[data-selected='true'] {\n      background: var(--affine-hover-color);\n    }\n\n    .affine-reference-title {\n      margin-left: 4px;\n      border-bottom: 0.5px solid var(--affine-divider-color);\n      transition: border 0.2s ease-out;\n    }\n    .affine-reference-title:hover {\n      border-bottom: 0.5px solid var(--affine-icon-color);\n    }\n  `;\n\n  private _updateRefMeta = (doc: Doc) => {\n    const refAttribute = this.delta.attributes?.reference;\n    if (!refAttribute) {\n      return;\n    }\n\n    const refMeta = doc.collection.meta.docMetas.find(\n      doc => doc.id === refAttribute.pageId\n    );\n    this.refMeta = refMeta\n      ? {\n          ...refMeta,\n        }\n      : undefined;\n  };\n\n  // Since the linked doc may be deleted, the `_refMeta` could be undefined.\n  @state()\n  accessor refMeta: DocMeta | undefined = undefined;\n\n  private _whenHover: HoverController = new HoverController(\n    this,\n    ({ abortController }) => {\n      if (\n        this.config.hidePopup ||\n        this.doc?.readonly ||\n        this.closest('.prevent-reference-popup') ||\n        !this.selfInlineRange ||\n        !this.inlineEditor\n      ) {\n        return null;\n      }\n\n      const selection = this.std?.selection;\n      if (!selection) {\n        return null;\n      }\n      const textSelection = selection.find('text');\n      if (!!textSelection && !textSelection.isCollapsed()) {\n        return null;\n      }\n\n      const blockSelections = selection.filter('block');\n      if (blockSelections.length) {\n        return null;\n      }\n\n      return {\n        template: toggleReferencePopup(\n          this,\n          this.referenceToNode(),\n          this.referenceInfo,\n          this.inlineEditor,\n          this.selfInlineRange,\n          this.refMeta?.title ?? DEFAULT_DOC_NAME,\n          abortController\n        ),\n      };\n    },\n    { enterDelay: 500 }\n  );\n\n  get _icon() {\n    const { pageId, params, title } = this.referenceInfo;\n    return this.block?.std\n      ?.get(DocDisplayMetaProvider)\n      .icon(pageId, { params, title, referenced: true }).value;\n  }\n\n  get _title() {\n    const { pageId, params, title } = this.referenceInfo;\n    return (\n      title ||\n      this.block?.std\n        ?.get(DocDisplayMetaProvider)\n        .title(pageId, { params, title, referenced: true }).value\n    );\n  }\n\n  get block() {\n    const block = this.inlineEditor?.rootElement.closest<BlockComponent>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    return block;\n  }\n\n  get customContent() {\n    return this.config.customContent;\n  }\n\n  get doc() {\n    const doc = this.config.doc;\n    return doc;\n  }\n\n  get inlineEditor() {\n    const inlineRoot = this.closest<InlineRootElement<AffineTextAttributes>>(\n      `[${INLINE_ROOT_ATTR}]`\n    );\n    return inlineRoot?.inlineEditor;\n  }\n\n  get referenceInfo(): ReferenceInfo {\n    const reference = this.delta.attributes?.reference;\n    const id = this.doc?.id ?? '';\n    if (!reference) return { pageId: id };\n    return cloneReferenceInfo(reference);\n  }\n\n  get selfInlineRange() {\n    const selfInlineRange = this.inlineEditor?.getInlineRangeFromElement(this);\n    return selfInlineRange;\n  }\n\n  get std() {\n    const std = this.block?.std;\n    if (!std) {\n      throw new BlockSuiteError(\n        ErrorCode.ValueNotExists,\n        'std not found in reference node'\n      );\n    }\n    return std;\n  }\n\n  private _onClick() {\n    if (!this.config.interactable) return;\n    this.std\n      .getOptional(RefNodeSlotsProvider)\n      ?.docLinkClicked.emit(this.referenceInfo);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.config) {\n      console.error('`reference-node` need `ReferenceNodeConfig`.');\n      return;\n    }\n\n    if (this.delta.insert !== REFERENCE_NODE) {\n      console.error(\n        `Reference node must be initialized with '${REFERENCE_NODE}', but got '${this.delta.insert}'`\n      );\n    }\n\n    const doc = this.doc;\n    if (doc) {\n      this._disposables.add(\n        doc.collection.slots.docUpdated.on(() => this._updateRefMeta(doc))\n      );\n    }\n\n    this.updateComplete\n      .then(() => {\n        if (!this.inlineEditor || !doc) return;\n\n        // observe yText update\n        this.disposables.add(\n          this.inlineEditor.slots.textChange.on(() => this._updateRefMeta(doc))\n        );\n      })\n      .catch(console.error);\n  }\n\n  // reference to block/element\n  referenceToNode() {\n    return referenceToNode(this.referenceInfo);\n  }\n\n  override render() {\n    const refMeta = this.refMeta;\n    const isDeleted = !refMeta;\n\n    const attributes = this.delta.attributes;\n    const reference = attributes?.reference;\n    const type = reference?.type;\n    if (!attributes || !type) {\n      return nothing;\n    }\n\n    const title = this._title;\n    const icon = choose(type, [\n      ['LinkedPage', () => this._icon],\n      [\n        'Subpage',\n        () =>\n          LinkedPageIcon({\n            width: '1.25em',\n            height: '1.25em',\n            style:\n              'user-select:none;flex-shrink:0;vertical-align:middle;font-size:inherit;margin-bottom:0.1em;',\n          }),\n      ],\n    ]);\n\n    const style = affineTextStyles(\n      attributes,\n      isDeleted\n        ? {\n            color: 'var(--affine-text-disable-color)',\n            textDecoration: 'line-through',\n            fill: 'var(--affine-text-disable-color)',\n          }\n        : {}\n    );\n\n    const content = this.customContent\n      ? this.customContent(this)\n      : html`${icon}<span\n            data-title=${ifDefined(title)}\n            class=\"affine-reference-title\"\n            >${title}</span\n          >`;\n\n    // we need to add `<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text>` in an\n    // embed element to make sure inline range calculation is correct\n    return html`<span\n      ${this.config.interactable ? ref(this._whenHover.setReference) : ''}\n      data-selected=${this.selected}\n      class=\"affine-reference\"\n      style=${styleMap(style)}\n      @click=${this._onClick}\n      >${content}<v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text\n    ></span>`;\n  }\n\n  override willUpdate(_changedProperties: Map<PropertyKey, unknown>) {\n    super.willUpdate(_changedProperties);\n\n    const doc = this.doc;\n    if (doc) {\n      this._updateRefMeta(doc);\n    }\n  }\n\n  @property({ attribute: false })\n  accessor config!: ReferenceNodeConfigProvider;\n\n  @property({ type: Object })\n  accessor delta: DeltaInsert<AffineTextAttributes> = {\n    insert: ZERO_WIDTH_SPACE,\n    attributes: {},\n  };\n\n  @property({ type: Boolean })\n  accessor selected = false;\n}\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.d.ts.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.d.ts.map
index 72b9f8a..60065df 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"reference-popup.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AAC9D,OAAO,KAAK,EAAE,WAAW,EAAE,MAAM,oBAAoB,CAAC;AAStD,OAAO,EAEL,KAAK,cAAc,EACnB,KAAK,aAAa,EACnB,MAAM,uBAAuB,CAAC;AAI/B,OAAO,EAAQ,UAAU,EAAW,MAAM,KAAK,CAAC;AAMhD,OAAO,KAAK,EAAE,kBAAkB,EAAE,MAAM,8BAA8B,CAAC;;AAyBvE,qBAAa,cAAe,SAAQ,mBAA0B;IAC5D,OAAgB,MAAM,0BAAU;IAEhC,OAAO,CAAC,SAAS,CAaf;IAEF,OAAO,CAAC,QAAQ,CAId;IAEF,OAAO,CAAC,cAAc,CAyBpB;IAEF,OAAO,CAAC,mBAAmB,CAKzB;IAEF,OAAO,CAAC,kBAAkB,CAKxB;IAEF,IAAI,wBAAwB,YAe3B;IAED,IAAI,mBAAmB,YAEtB;IAED,IAAI,KAAK,sIAMR;IAED,IAAI,GAAG,oCAIN;IAED,IAAI,cAAc,WAKjB;IAED,IAAI,GAAG,kBAIN;IAED,OAAO,CAAC,kBAAkB;IA0B1B,OAAO,CAAC,mBAAmB;IAiC3B,OAAO,CAAC,OAAO;IAOf,OAAO,CAAC,YAAY;IAcpB,OAAO,CAAC,eAAe;IA4DvB,OAAO,CAAC,aAAa;IAuEZ,iBAAiB;IAmBjB,MAAM;IA0EN,OAAO;IA4BhB,QAAQ,CAAC,eAAe,EAAG,eAAe,CAAC;IAG3C,QAAQ,CAAC,QAAQ,EAAG,MAAM,CAAC;IAG3B,QAAQ,CAAC,YAAY,EAAG,kBAAkB,CAAC;IAG3C,QAAQ,CAAC,YAAY,EAAG,OAAO,CAAC;IAGhC,QAAQ,CAAC,cAAc,EAAG,cAAc,CAAC;IAGzC,QAAQ,CAAC,aAAa,EAAG,aAAa,CAAC;IAGvC,QAAQ,CAAC,MAAM,EAAG,UAAU,CAAC;IAG7B,QAAQ,CAAC,iBAAiB,EAAG,WAAW,CAAC;CAC1C;AAED,wBAAgB,oBAAoB,CAClC,MAAM,EAAE,UAAU,EAClB,YAAY,EAAE,OAAO,EACrB,aAAa,EAAE,aAAa,EAC5B,YAAY,EAAE,kBAAkB,EAChC,iBAAiB,EAAE,WAAW,EAC9B,QAAQ,EAAE,MAAM,EAChB,eAAe,EAAE,eAAe,GAC/B,cAAc,CAahB"}
\ No newline at end of file
+{"version":3,"file":"reference-popup.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AAC9D,OAAO,KAAK,EAAE,WAAW,EAAE,MAAM,oBAAoB,CAAC;AAYtD,OAAO,EAEL,KAAK,cAAc,EACnB,KAAK,aAAa,EACnB,MAAM,uBAAuB,CAAC;AAI/B,OAAO,EAAQ,UAAU,EAAW,MAAM,KAAK,CAAC;AAMhD,OAAO,KAAK,EAAE,kBAAkB,EAAE,MAAM,8BAA8B,CAAC;;AAwBvE,qBAAa,cAAe,SAAQ,mBAA0B;IAC5D,OAAgB,MAAM,0BAAU;IAEhC,OAAO,CAAC,SAAS,CAaf;IAEF,OAAO,CAAC,QAAQ,CAId;IAEF,OAAO,CAAC,cAAc,CA6BpB;IAEF,OAAO,CAAC,mBAAmB,CAKzB;IAEF,OAAO,CAAC,kBAAkB,CAKxB;IAEF,IAAI,wBAAwB,YAe3B;IAED,IAAI,mBAAmB,YAEtB;IAED,IAAI,KAAK,sIAMR;IAED,IAAI,GAAG,oCAIN;IAED,IAAI,cAAc,WAKjB;IAED,IAAI,GAAG,kBAIN;IAED,OAAO,CAAC,kBAAkB;IA0B1B,OAAO,CAAC,mBAAmB;IAiC3B,OAAO,CAAC,OAAO;IAOf,OAAO,CAAC,YAAY;IAcpB,OAAO,CAAC,eAAe;IA4DvB,OAAO,CAAC,aAAa;IAuEZ,iBAAiB;IAmBjB,MAAM;IA0EN,OAAO;IA4BhB,QAAQ,CAAC,eAAe,EAAG,eAAe,CAAC;IAG3C,QAAQ,CAAC,QAAQ,EAAG,MAAM,CAAC;IAG3B,QAAQ,CAAC,YAAY,EAAG,kBAAkB,CAAC;IAG3C,QAAQ,CAAC,YAAY,EAAG,OAAO,CAAC;IAGhC,QAAQ,CAAC,cAAc,EAAG,cAAc,CAAC;IAGzC,QAAQ,CAAC,aAAa,EAAG,aAAa,CAAC;IAGvC,QAAQ,CAAC,MAAM,EAAG,UAAU,CAAC;IAG7B,QAAQ,CAAC,iBAAiB,EAAG,WAAW,CAAC;CAC1C;AAED,wBAAgB,oBAAoB,CAClC,MAAM,EAAE,UAAU,EAClB,YAAY,EAAE,OAAO,EACrB,aAAa,EAAE,aAAa,EAC5B,YAAY,EAAE,kBAAkB,EAChC,iBAAiB,EAAE,WAAW,EAC9B,QAAQ,EAAE,MAAM,EAChB,eAAe,EAAE,eAAe,GAC/B,cAAc,CAahB"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js
index 8e2f655..4f327fe 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js
@@ -33,7 +33,7 @@ var __runInitializers = (this && this.__runInitializers) || function (thisArg, i
     return useValue ? value : void 0;
 };
 import { GenerateDocUrlProvider, TelemetryProvider, } from '@blocksuite/affine-shared/services';
-import { isInsideBlockByFlavour } from '@blocksuite/affine-shared/utils';
+import { cloneReferenceInfoWithoutAliases, isInsideBlockByFlavour, } from '@blocksuite/affine-shared/utils';
 import { BLOCK_ID_ATTR, } from '@blocksuite/block-std';
 import { assertExists, WithDisposable } from '@blocksuite/global/utils';
 import { computePosition, inline, offset, shift } from '@floating-ui/dom';
@@ -51,7 +51,6 @@ import { renderActions, renderToolbarSeparator, } from '../../../../../toolbar/i
 import { RefNodeSlotsProvider } from '../../../../extension/index.js';
 import { ReferenceAliasPopup } from './reference-alias-popup.js';
 import { styles } from './styles.js';
-import { cloneReferenceInfoWithoutAliases } from './utils.js';
 let ReferencePopup = (() => {
     let _classSuper = WithDisposable(LitElement);
     let _abortController_decorators;
@@ -449,6 +448,9 @@ let ReferencePopup = (() => {
             };
             this._openEditPopup = (e) => {
                 e.stopPropagation();
+                if (document.body.querySelector('reference-alias-popup')) {
+                    return;
+                }
                 const { std, docTitle, referenceInfo, inlineEditor, targetInlineRange, abortController, } = this;
                 const aliasPopup = new ReferenceAliasPopup();
                 aliasPopup.std = std;
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js.map
index c44db50..738a4ea 100644
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/reference-popup.js.map
@@ -1 +1 @@
-{"version":3,"file":"reference-popup.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReferenceInfo } from '@blocksuite/affine-model';\nimport type { InlineRange } from '@blocksuite/inline';\n\nimport {\n  GenerateDocUrlProvider,\n  type LinkEventType,\n  type TelemetryEvent,\n  TelemetryProvider,\n} from '@blocksuite/affine-shared/services';\nimport { isInsideBlockByFlavour } from '@blocksuite/affine-shared/utils';\nimport {\n  BLOCK_ID_ATTR,\n  type BlockComponent,\n  type BlockStdScope,\n} from '@blocksuite/block-std';\nimport { assertExists, WithDisposable } from '@blocksuite/global/utils';\nimport { computePosition, inline, offset, shift } from '@floating-ui/dom';\nimport { effect } from '@preact/signals-core';\nimport { html, LitElement, nothing } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AffineInlineEditor } from '../../affine-inline-specs.js';\n\nimport {\n  CenterPeekIcon,\n  CopyIcon,\n  DeleteIcon,\n  EditIcon,\n  ExpandFullSmallIcon,\n  MoreVerticalIcon,\n  OpenIcon,\n  SmallArrowDownIcon,\n} from '../../../../../icons/index.js';\nimport { notifyLinkedDocSwitchedToEmbed } from '../../../../../notification/index.js';\nimport { isPeekable, peek } from '../../../../../peek/index.js';\nimport { toast } from '../../../../../toast/toast.js';\nimport {\n  type MenuItem,\n  renderActions,\n  renderToolbarSeparator,\n} from '../../../../../toolbar/index.js';\nimport { RefNodeSlotsProvider } from '../../../../extension/index.js';\nimport { ReferenceAliasPopup } from './reference-alias-popup.js';\nimport { styles } from './styles.js';\nimport { cloneReferenceInfoWithoutAliases } from './utils.js';\n\nexport class ReferencePopup extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  private _copyLink = () => {\n    const url = this.std\n      .getOptional(GenerateDocUrlProvider)\n      ?.generateDocUrl(this.referenceInfo.pageId, this.referenceInfo.params);\n\n    if (url) {\n      navigator.clipboard.writeText(url).catch(console.error);\n      toast(this.std.host, 'Copied link to clipboard');\n    }\n\n    this.abortController.abort();\n\n    track(this.std, 'CopiedLink', { control: 'copy link' });\n  };\n\n  private _openDoc = () => {\n    this.std\n      .getOptional(RefNodeSlotsProvider)\n      ?.docLinkClicked.emit(this.referenceInfo);\n  };\n\n  private _openEditPopup = (e: MouseEvent) => {\n    e.stopPropagation();\n\n    const {\n      std,\n      docTitle,\n      referenceInfo,\n      inlineEditor,\n      targetInlineRange,\n      abortController,\n    } = this;\n\n    const aliasPopup = new ReferenceAliasPopup();\n\n    aliasPopup.std = std;\n    aliasPopup.docTitle = docTitle;\n    aliasPopup.referenceInfo = referenceInfo;\n    aliasPopup.inlineEditor = inlineEditor;\n    aliasPopup.inlineRange = targetInlineRange;\n\n    document.body.append(aliasPopup);\n\n    abortController.abort();\n\n    track(std, 'OpenedAliasPopup', { control: 'edit' });\n  };\n\n  private _toggleViewSelector = (e: Event) => {\n    const opened = (e as CustomEvent<boolean>).detail;\n    if (!opened) return;\n\n    track(this.std, 'OpenedViewSelector', { control: 'switch view' });\n  };\n\n  private _trackViewSelected = (type: string) => {\n    track(this.std, 'SelectedView', {\n      control: 'select view',\n      type: `${type} view`,\n    });\n  };\n\n  get _embedViewButtonDisabled() {\n    if (\n      this.block.doc.readonly ||\n      isInsideBlockByFlavour(\n        this.block.doc,\n        this.block.model,\n        'affine:edgeless-text'\n      )\n    ) {\n      return true;\n    }\n    return (\n      !!this.block.closest('affine-embed-synced-doc-block') ||\n      this.referenceDocId === this.doc.id\n    );\n  }\n\n  get _openButtonDisabled() {\n    return this.referenceDocId === this.doc.id;\n  }\n\n  get block() {\n    const block = this.inlineEditor.rootElement.closest<BlockComponent>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    assertExists(block);\n    return block;\n  }\n\n  get doc() {\n    const doc = this.block.doc;\n    assertExists(doc);\n    return doc;\n  }\n\n  get referenceDocId() {\n    const docId = this.inlineEditor.getFormat(this.targetInlineRange).reference\n      ?.pageId;\n    assertExists(docId);\n    return docId;\n  }\n\n  get std() {\n    const std = this.block.std;\n    assertExists(std);\n    return std;\n  }\n\n  private _convertToCardView() {\n    const block = this.block;\n    const doc = block.host.doc;\n    const parent = doc.getParent(block.model);\n    assertExists(parent);\n\n    const index = parent.children.indexOf(block.model);\n\n    doc.addBlock(\n      'affine:embed-linked-doc',\n      this.referenceInfo,\n      parent,\n      index + 1\n    );\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.insertText(this.targetInlineRange, this.docTitle);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _convertToEmbedView() {\n    const block = this.block;\n    const std = block.std;\n    const doc = block.host.doc;\n    const parent = doc.getParent(block.model);\n    assertExists(parent);\n\n    const index = parent.children.indexOf(block.model);\n    const referenceInfo = this.referenceInfo;\n    const hasTitleAlias = Boolean(referenceInfo.title);\n\n    doc.addBlock(\n      'affine:embed-synced-doc',\n      cloneReferenceInfoWithoutAliases(referenceInfo),\n      parent,\n      index + 1\n    );\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.insertText(this.targetInlineRange, this.docTitle);\n    }\n\n    if (hasTitleAlias) {\n      notifyLinkedDocSwitchedToEmbed(std);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _delete() {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.deleteText(this.targetInlineRange);\n    }\n    this.abortController.abort();\n  }\n\n  private _moreActions() {\n    return renderActions([\n      [\n        {\n          type: 'delete',\n          label: 'Delete',\n          icon: DeleteIcon,\n          disabled: this.doc.readonly,\n          action: () => this._delete(),\n        },\n      ],\n    ]);\n  }\n\n  private _openMenuButton() {\n    const buttons: MenuItem[] = [\n      {\n        label: 'Open this doc',\n        type: 'open-this-doc',\n        icon: ExpandFullSmallIcon,\n        action: this._openDoc,\n        disabled: this._openButtonDisabled,\n      },\n    ];\n\n    // open in new tab\n\n    if (isPeekable(this.target)) {\n      buttons.push({\n        label: 'Open in center peek',\n        type: 'open-in-center-peek',\n        icon: CenterPeekIcon,\n        action: () => peek(this.target),\n      });\n    }\n\n    // open in split view\n\n    if (buttons.length === 0) {\n      return nothing;\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Open doc\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n          >\n            ${OpenIcon}${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"large\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.label,\n            ({ label, icon, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${ifDefined(label)}\n                ?disabled=${disabled}\n                @click=${action}\n              >\n                ${icon}<span class=\"label\">${label}</span>\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  private _viewSelector() {\n    // synced doc entry controlled by awareness flag\n    const isSyncedDocEnabled = this.doc.awarenessStore.getFlag(\n      'enable_synced_doc_block'\n    );\n    const buttons = [];\n\n    buttons.push({\n      type: 'inline',\n      label: 'Inline view',\n    });\n\n    buttons.push({\n      type: 'card',\n      label: 'Card view',\n      action: () => this._convertToCardView(),\n      disabled: this.doc.readonly,\n    });\n\n    if (isSyncedDocEnabled) {\n      buttons.push({\n        type: 'embed',\n        label: 'Embed view',\n        action: () => this._convertToEmbedView(),\n        disabled:\n          this.doc.readonly ||\n          this.isLinkedNode ||\n          this._embedViewButtonDisabled,\n      });\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Switch view\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n            .iconContainerWidth=${'110px'}\n          >\n            <span class=\"label\">Inline view</span>\n            ${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n        @toggle=${this._toggleViewSelector}\n      >\n        <div data-size=\"small\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.type,\n            ({ type, label, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${label}\n                data-testid=${`link-to-${type}`}\n                ?data-selected=${type === 'inline'}\n                ?disabled=${disabled || type === 'inline'}\n                @click=${() => {\n                  action?.();\n                  this._trackViewSelected(type);\n                }}\n              >\n                ${label}\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this.targetInlineRange.length === 0) {\n      return;\n    }\n\n    const parent = this.block.host.doc.getParent(this.block.model);\n    assertExists(parent);\n\n    this.disposables.add(\n      effect(() => {\n        const children = parent.children;\n        if (children.includes(this.block.model)) return;\n        this.abortController.abort();\n      })\n    );\n  }\n\n  override render() {\n    const titleButton = this.referenceInfo.title\n      ? html`\n          <editor-icon-button\n            class=\"doc-title\"\n            aria-label=\"Doc title\"\n            .hover=${false}\n            .labelHeight=${'20px'}\n            .tooltip=${this.docTitle}\n            @click=${this._openDoc}\n          >\n            <span class=\"label\">${this.docTitle}</span>\n          </editor-icon-button>\n        `\n      : nothing;\n\n    const buttons = [\n      this._openMenuButton(),\n\n      html`\n        ${titleButton}\n\n        <editor-icon-button\n          aria-label=\"Copy link\"\n          data-testid=\"copy-link\"\n          .tooltip=${'Copy link'}\n          @click=${this._copyLink}\n        >\n          ${CopyIcon}\n        </editor-icon-button>\n\n        <editor-icon-button\n          aria-label=\"Edit\"\n          data-testid=\"edit\"\n          .tooltip=${'Edit'}\n          ?disabled=${this.doc.readonly}\n          @click=${this._openEditPopup}\n        >\n          ${EditIcon}\n        </editor-icon-button>\n      `,\n\n      this._viewSelector(),\n\n      html`\n        <editor-menu-button\n          .contentPadding=${'8px'}\n          .button=${html`\n            <editor-icon-button aria-label=\"More\" .tooltip=${'More'}>\n              ${MoreVerticalIcon}\n            </editor-icon-button>\n          `}\n        >\n          <div data-size=\"large\" data-orientation=\"vertical\">\n            ${this._moreActions()}\n          </div>\n        </editor-menu-button>\n      `,\n    ];\n\n    return html`\n      <div class=\"overlay-root\">\n        <div class=\"affine-reference-popover-container\">\n          <editor-toolbar class=\"affine-reference-popover view\">\n            ${join(\n              buttons.filter(button => button !== nothing),\n              renderToolbarSeparator\n            )}\n          </editor-toolbar>\n        </div>\n      </div>\n    `;\n  }\n\n  override updated() {\n    assertExists(this.popupContainer);\n    const range = this.inlineEditor.toDomRange(this.targetInlineRange);\n    assertExists(range);\n\n    const visualElement = {\n      getBoundingClientRect: () => range.getBoundingClientRect(),\n      getClientRects: () => range.getClientRects(),\n    };\n    computePosition(visualElement, this.popupContainer, {\n      middleware: [\n        offset(10),\n        inline(),\n        shift({\n          padding: 6,\n        }),\n      ],\n    })\n      .then(({ x, y }) => {\n        const popupContainer = this.popupContainer;\n        if (!popupContainer) return;\n        popupContainer.style.left = `${x}px`;\n        popupContainer.style.top = `${y}px`;\n      })\n      .catch(console.error);\n  }\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @property({ attribute: false })\n  accessor docTitle!: string;\n\n  @property({ attribute: false })\n  accessor inlineEditor!: AffineInlineEditor;\n\n  @property({ attribute: false })\n  accessor isLinkedNode!: boolean;\n\n  @query('.affine-reference-popover-container')\n  accessor popupContainer!: HTMLDivElement;\n\n  @property({ type: Object })\n  accessor referenceInfo!: ReferenceInfo;\n\n  @property({ attribute: false })\n  accessor target!: LitElement;\n\n  @property({ attribute: false })\n  accessor targetInlineRange!: InlineRange;\n}\n\nexport function toggleReferencePopup(\n  target: LitElement,\n  isLinkedNode: boolean,\n  referenceInfo: ReferenceInfo,\n  inlineEditor: AffineInlineEditor,\n  targetInlineRange: InlineRange,\n  docTitle: string,\n  abortController: AbortController\n): ReferencePopup {\n  const popup = new ReferencePopup();\n  popup.target = target;\n  popup.isLinkedNode = isLinkedNode;\n  popup.referenceInfo = referenceInfo;\n  popup.inlineEditor = inlineEditor;\n  popup.targetInlineRange = targetInlineRange;\n  popup.docTitle = docTitle;\n  popup.abortController = abortController;\n\n  document.body.append(popup);\n\n  return popup;\n}\n\nfunction track(\n  std: BlockStdScope,\n  event: LinkEventType,\n  props: Partial<TelemetryEvent>\n) {\n  std.getOptional(TelemetryProvider)?.track(event, {\n    segment: 'toolbar',\n    page: 'doc editor',\n    module: 'reference toolbar',\n    type: 'inline view',\n    category: 'linked doc',\n    ...props,\n  });\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"reference-popup.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReferenceInfo } from '@blocksuite/affine-model';\nimport type { InlineRange } from '@blocksuite/inline';\n\nimport {\n  GenerateDocUrlProvider,\n  type LinkEventType,\n  type TelemetryEvent,\n  TelemetryProvider,\n} from '@blocksuite/affine-shared/services';\nimport {\n  cloneReferenceInfoWithoutAliases,\n  isInsideBlockByFlavour,\n} from '@blocksuite/affine-shared/utils';\nimport {\n  BLOCK_ID_ATTR,\n  type BlockComponent,\n  type BlockStdScope,\n} from '@blocksuite/block-std';\nimport { assertExists, WithDisposable } from '@blocksuite/global/utils';\nimport { computePosition, inline, offset, shift } from '@floating-ui/dom';\nimport { effect } from '@preact/signals-core';\nimport { html, LitElement, nothing } from 'lit';\nimport { property, query } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { join } from 'lit/directives/join.js';\nimport { repeat } from 'lit/directives/repeat.js';\n\nimport type { AffineInlineEditor } from '../../affine-inline-specs.js';\n\nimport {\n  CenterPeekIcon,\n  CopyIcon,\n  DeleteIcon,\n  EditIcon,\n  ExpandFullSmallIcon,\n  MoreVerticalIcon,\n  OpenIcon,\n  SmallArrowDownIcon,\n} from '../../../../../icons/index.js';\nimport { notifyLinkedDocSwitchedToEmbed } from '../../../../../notification/index.js';\nimport { isPeekable, peek } from '../../../../../peek/index.js';\nimport { toast } from '../../../../../toast/toast.js';\nimport {\n  type MenuItem,\n  renderActions,\n  renderToolbarSeparator,\n} from '../../../../../toolbar/index.js';\nimport { RefNodeSlotsProvider } from '../../../../extension/index.js';\nimport { ReferenceAliasPopup } from './reference-alias-popup.js';\nimport { styles } from './styles.js';\n\nexport class ReferencePopup extends WithDisposable(LitElement) {\n  static override styles = styles;\n\n  private _copyLink = () => {\n    const url = this.std\n      .getOptional(GenerateDocUrlProvider)\n      ?.generateDocUrl(this.referenceInfo.pageId, this.referenceInfo.params);\n\n    if (url) {\n      navigator.clipboard.writeText(url).catch(console.error);\n      toast(this.std.host, 'Copied link to clipboard');\n    }\n\n    this.abortController.abort();\n\n    track(this.std, 'CopiedLink', { control: 'copy link' });\n  };\n\n  private _openDoc = () => {\n    this.std\n      .getOptional(RefNodeSlotsProvider)\n      ?.docLinkClicked.emit(this.referenceInfo);\n  };\n\n  private _openEditPopup = (e: MouseEvent) => {\n    e.stopPropagation();\n\n    if (document.body.querySelector('reference-alias-popup')) {\n      return;\n    }\n\n    const {\n      std,\n      docTitle,\n      referenceInfo,\n      inlineEditor,\n      targetInlineRange,\n      abortController,\n    } = this;\n\n    const aliasPopup = new ReferenceAliasPopup();\n\n    aliasPopup.std = std;\n    aliasPopup.docTitle = docTitle;\n    aliasPopup.referenceInfo = referenceInfo;\n    aliasPopup.inlineEditor = inlineEditor;\n    aliasPopup.inlineRange = targetInlineRange;\n\n    document.body.append(aliasPopup);\n\n    abortController.abort();\n\n    track(std, 'OpenedAliasPopup', { control: 'edit' });\n  };\n\n  private _toggleViewSelector = (e: Event) => {\n    const opened = (e as CustomEvent<boolean>).detail;\n    if (!opened) return;\n\n    track(this.std, 'OpenedViewSelector', { control: 'switch view' });\n  };\n\n  private _trackViewSelected = (type: string) => {\n    track(this.std, 'SelectedView', {\n      control: 'select view',\n      type: `${type} view`,\n    });\n  };\n\n  get _embedViewButtonDisabled() {\n    if (\n      this.block.doc.readonly ||\n      isInsideBlockByFlavour(\n        this.block.doc,\n        this.block.model,\n        'affine:edgeless-text'\n      )\n    ) {\n      return true;\n    }\n    return (\n      !!this.block.closest('affine-embed-synced-doc-block') ||\n      this.referenceDocId === this.doc.id\n    );\n  }\n\n  get _openButtonDisabled() {\n    return this.referenceDocId === this.doc.id;\n  }\n\n  get block() {\n    const block = this.inlineEditor.rootElement.closest<BlockComponent>(\n      `[${BLOCK_ID_ATTR}]`\n    );\n    assertExists(block);\n    return block;\n  }\n\n  get doc() {\n    const doc = this.block.doc;\n    assertExists(doc);\n    return doc;\n  }\n\n  get referenceDocId() {\n    const docId = this.inlineEditor.getFormat(this.targetInlineRange).reference\n      ?.pageId;\n    assertExists(docId);\n    return docId;\n  }\n\n  get std() {\n    const std = this.block.std;\n    assertExists(std);\n    return std;\n  }\n\n  private _convertToCardView() {\n    const block = this.block;\n    const doc = block.host.doc;\n    const parent = doc.getParent(block.model);\n    assertExists(parent);\n\n    const index = parent.children.indexOf(block.model);\n\n    doc.addBlock(\n      'affine:embed-linked-doc',\n      this.referenceInfo,\n      parent,\n      index + 1\n    );\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.insertText(this.targetInlineRange, this.docTitle);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _convertToEmbedView() {\n    const block = this.block;\n    const std = block.std;\n    const doc = block.host.doc;\n    const parent = doc.getParent(block.model);\n    assertExists(parent);\n\n    const index = parent.children.indexOf(block.model);\n    const referenceInfo = this.referenceInfo;\n    const hasTitleAlias = Boolean(referenceInfo.title);\n\n    doc.addBlock(\n      'affine:embed-synced-doc',\n      cloneReferenceInfoWithoutAliases(referenceInfo),\n      parent,\n      index + 1\n    );\n\n    const totalTextLength = this.inlineEditor.yTextLength;\n    const inlineTextLength = this.targetInlineRange.length;\n    if (totalTextLength === inlineTextLength) {\n      doc.deleteBlock(block.model);\n    } else {\n      this.inlineEditor.insertText(this.targetInlineRange, this.docTitle);\n    }\n\n    if (hasTitleAlias) {\n      notifyLinkedDocSwitchedToEmbed(std);\n    }\n\n    this.abortController.abort();\n  }\n\n  private _delete() {\n    if (this.inlineEditor.isValidInlineRange(this.targetInlineRange)) {\n      this.inlineEditor.deleteText(this.targetInlineRange);\n    }\n    this.abortController.abort();\n  }\n\n  private _moreActions() {\n    return renderActions([\n      [\n        {\n          type: 'delete',\n          label: 'Delete',\n          icon: DeleteIcon,\n          disabled: this.doc.readonly,\n          action: () => this._delete(),\n        },\n      ],\n    ]);\n  }\n\n  private _openMenuButton() {\n    const buttons: MenuItem[] = [\n      {\n        label: 'Open this doc',\n        type: 'open-this-doc',\n        icon: ExpandFullSmallIcon,\n        action: this._openDoc,\n        disabled: this._openButtonDisabled,\n      },\n    ];\n\n    // open in new tab\n\n    if (isPeekable(this.target)) {\n      buttons.push({\n        label: 'Open in center peek',\n        type: 'open-in-center-peek',\n        icon: CenterPeekIcon,\n        action: () => peek(this.target),\n      });\n    }\n\n    // open in split view\n\n    if (buttons.length === 0) {\n      return nothing;\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Open doc\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n          >\n            ${OpenIcon}${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n      >\n        <div data-size=\"large\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.label,\n            ({ label, icon, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${ifDefined(label)}\n                ?disabled=${disabled}\n                @click=${action}\n              >\n                ${icon}<span class=\"label\">${label}</span>\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  private _viewSelector() {\n    // synced doc entry controlled by awareness flag\n    const isSyncedDocEnabled = this.doc.awarenessStore.getFlag(\n      'enable_synced_doc_block'\n    );\n    const buttons = [];\n\n    buttons.push({\n      type: 'inline',\n      label: 'Inline view',\n    });\n\n    buttons.push({\n      type: 'card',\n      label: 'Card view',\n      action: () => this._convertToCardView(),\n      disabled: this.doc.readonly,\n    });\n\n    if (isSyncedDocEnabled) {\n      buttons.push({\n        type: 'embed',\n        label: 'Embed view',\n        action: () => this._convertToEmbedView(),\n        disabled:\n          this.doc.readonly ||\n          this.isLinkedNode ||\n          this._embedViewButtonDisabled,\n      });\n    }\n\n    return html`\n      <editor-menu-button\n        .contentPadding=${'8px'}\n        .button=${html`\n          <editor-icon-button\n            aria-label=\"Switch view\"\n            .justify=${'space-between'}\n            .labelHeight=${'20px'}\n            .iconContainerWidth=${'110px'}\n          >\n            <span class=\"label\">Inline view</span>\n            ${SmallArrowDownIcon}\n          </editor-icon-button>\n        `}\n        @toggle=${this._toggleViewSelector}\n      >\n        <div data-size=\"small\" data-orientation=\"vertical\">\n          ${repeat(\n            buttons,\n            button => button.type,\n            ({ type, label, action, disabled }) => html`\n              <editor-menu-action\n                aria-label=${label}\n                data-testid=${`link-to-${type}`}\n                ?data-selected=${type === 'inline'}\n                ?disabled=${disabled || type === 'inline'}\n                @click=${() => {\n                  action?.();\n                  this._trackViewSelected(type);\n                }}\n              >\n                ${label}\n              </editor-menu-action>\n            `\n          )}\n        </div>\n      </editor-menu-button>\n    `;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    if (this.targetInlineRange.length === 0) {\n      return;\n    }\n\n    const parent = this.block.host.doc.getParent(this.block.model);\n    assertExists(parent);\n\n    this.disposables.add(\n      effect(() => {\n        const children = parent.children;\n        if (children.includes(this.block.model)) return;\n        this.abortController.abort();\n      })\n    );\n  }\n\n  override render() {\n    const titleButton = this.referenceInfo.title\n      ? html`\n          <editor-icon-button\n            class=\"doc-title\"\n            aria-label=\"Doc title\"\n            .hover=${false}\n            .labelHeight=${'20px'}\n            .tooltip=${this.docTitle}\n            @click=${this._openDoc}\n          >\n            <span class=\"label\">${this.docTitle}</span>\n          </editor-icon-button>\n        `\n      : nothing;\n\n    const buttons = [\n      this._openMenuButton(),\n\n      html`\n        ${titleButton}\n\n        <editor-icon-button\n          aria-label=\"Copy link\"\n          data-testid=\"copy-link\"\n          .tooltip=${'Copy link'}\n          @click=${this._copyLink}\n        >\n          ${CopyIcon}\n        </editor-icon-button>\n\n        <editor-icon-button\n          aria-label=\"Edit\"\n          data-testid=\"edit\"\n          .tooltip=${'Edit'}\n          ?disabled=${this.doc.readonly}\n          @click=${this._openEditPopup}\n        >\n          ${EditIcon}\n        </editor-icon-button>\n      `,\n\n      this._viewSelector(),\n\n      html`\n        <editor-menu-button\n          .contentPadding=${'8px'}\n          .button=${html`\n            <editor-icon-button aria-label=\"More\" .tooltip=${'More'}>\n              ${MoreVerticalIcon}\n            </editor-icon-button>\n          `}\n        >\n          <div data-size=\"large\" data-orientation=\"vertical\">\n            ${this._moreActions()}\n          </div>\n        </editor-menu-button>\n      `,\n    ];\n\n    return html`\n      <div class=\"overlay-root\">\n        <div class=\"affine-reference-popover-container\">\n          <editor-toolbar class=\"affine-reference-popover view\">\n            ${join(\n              buttons.filter(button => button !== nothing),\n              renderToolbarSeparator\n            )}\n          </editor-toolbar>\n        </div>\n      </div>\n    `;\n  }\n\n  override updated() {\n    assertExists(this.popupContainer);\n    const range = this.inlineEditor.toDomRange(this.targetInlineRange);\n    assertExists(range);\n\n    const visualElement = {\n      getBoundingClientRect: () => range.getBoundingClientRect(),\n      getClientRects: () => range.getClientRects(),\n    };\n    computePosition(visualElement, this.popupContainer, {\n      middleware: [\n        offset(10),\n        inline(),\n        shift({\n          padding: 6,\n        }),\n      ],\n    })\n      .then(({ x, y }) => {\n        const popupContainer = this.popupContainer;\n        if (!popupContainer) return;\n        popupContainer.style.left = `${x}px`;\n        popupContainer.style.top = `${y}px`;\n      })\n      .catch(console.error);\n  }\n\n  @property({ attribute: false })\n  accessor abortController!: AbortController;\n\n  @property({ attribute: false })\n  accessor docTitle!: string;\n\n  @property({ attribute: false })\n  accessor inlineEditor!: AffineInlineEditor;\n\n  @property({ attribute: false })\n  accessor isLinkedNode!: boolean;\n\n  @query('.affine-reference-popover-container')\n  accessor popupContainer!: HTMLDivElement;\n\n  @property({ type: Object })\n  accessor referenceInfo!: ReferenceInfo;\n\n  @property({ attribute: false })\n  accessor target!: LitElement;\n\n  @property({ attribute: false })\n  accessor targetInlineRange!: InlineRange;\n}\n\nexport function toggleReferencePopup(\n  target: LitElement,\n  isLinkedNode: boolean,\n  referenceInfo: ReferenceInfo,\n  inlineEditor: AffineInlineEditor,\n  targetInlineRange: InlineRange,\n  docTitle: string,\n  abortController: AbortController\n): ReferencePopup {\n  const popup = new ReferencePopup();\n  popup.target = target;\n  popup.isLinkedNode = isLinkedNode;\n  popup.referenceInfo = referenceInfo;\n  popup.inlineEditor = inlineEditor;\n  popup.targetInlineRange = targetInlineRange;\n  popup.docTitle = docTitle;\n  popup.abortController = abortController;\n\n  document.body.append(popup);\n\n  return popup;\n}\n\nfunction track(\n  std: BlockStdScope,\n  event: LinkEventType,\n  props: Partial<TelemetryEvent>\n) {\n  std.getOptional(TelemetryProvider)?.track(event, {\n    segment: 'toolbar',\n    page: 'doc editor',\n    module: 'reference toolbar',\n    type: 'inline view',\n    category: 'linked doc',\n    ...props,\n  });\n}\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.d.ts b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.d.ts
deleted file mode 100644
index 27a232b..0000000
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.d.ts
+++ /dev/null
@@ -1,37 +0,0 @@
-import type { ReferenceInfo } from '@blocksuite/affine-model';
-/**
- * Clones reference info.
- */
-export declare function cloneReferenceInfo({ pageId, params, title, description, }: ReferenceInfo): {
-    pageId: string;
-    description?: string | null | undefined;
-    title?: string | null | undefined;
-    params?: {
-        mode?: "edgeless" | "page" | undefined;
-        blockIds?: string[] | undefined;
-        elementIds?: string[] | undefined;
-        databaseId?: string | undefined;
-        databaseRowId?: string | undefined;
-    } | undefined;
-};
-/**
- * Returns true if it is a link to block or element.
- */
-export declare function referenceToNode({ params }: ReferenceInfo): boolean;
-/**
- * Clones reference info without the aliases.
- * In `EmbedSyncedDocModel`, the aliases are not needed at the moment.
- */
-export declare function cloneReferenceInfoWithoutAliases({ pageId, params, }: ReferenceInfo): {
-    pageId: string;
-    description?: string | null | undefined;
-    title?: string | null | undefined;
-    params?: {
-        mode?: "edgeless" | "page" | undefined;
-        blockIds?: string[] | undefined;
-        elementIds?: string[] | undefined;
-        databaseId?: string | undefined;
-        databaseRowId?: string | undefined;
-    } | undefined;
-};
-//# sourceMappingURL=utils.d.ts.map
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.d.ts.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.d.ts.map
deleted file mode 100644
index 41a0bba..0000000
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.d.ts.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"file":"utils.d.ts","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/utils.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AAI9D;;GAEG;AACH,wBAAgB,kBAAkB,CAAC,EACjC,MAAM,EACN,MAAM,EACN,KAAK,EACL,WAAW,GACZ,EAAE,aAAa;;;;;YAiCqqD,CAAC;gBAAmD,CAAC;kBAA0C,CAAC;kBAA0C,CAAC;qBAA2C,CAAC;;EA3B32D;AAED;;GAEG;AACH,wBAAgB,eAAe,CAAC,EAAE,MAAM,EAAE,EAAE,aAAa,WAQxD;AAED;;;GAGG;AACH,wBAAgB,gCAAgC,CAAC,EAC/C,MAAM,EACN,MAAM,GACP,EAAE,aAAa;;;;;YAKqqD,CAAC;gBAAmD,CAAC;kBAA0C,CAAC;kBAA0C,CAAC;qBAA2C,CAAC;;EAD32D"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.js b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.js
deleted file mode 100644
index eefc5d1..0000000
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.js
+++ /dev/null
@@ -1,42 +0,0 @@
-import cloneDeep from 'lodash.clonedeep';
-/**
- * Clones reference info.
- */
-export function cloneReferenceInfo({ pageId, params, title, description, }) {
-    const info = { pageId };
-    if (params)
-        info.params = cloneDeep(params);
-    if (title)
-        info.title = title;
-    if (description)
-        info.description = description;
-    return info;
-}
-/**
- * Returns true if it is a link to block or element.
- */
-export function referenceToNode({ params }) {
-    if (!params)
-        return false;
-    if (!params.mode)
-        return false;
-    const { blockIds, elementIds, databaseId, databaseRowId } = params;
-    if (blockIds && blockIds.length > 0)
-        return true;
-    if (elementIds && elementIds.length > 0)
-        return true;
-    if (databaseId || databaseRowId)
-        return true;
-    return false;
-}
-/**
- * Clones reference info without the aliases.
- * In `EmbedSyncedDocModel`, the aliases are not needed at the moment.
- */
-export function cloneReferenceInfoWithoutAliases({ pageId, params, }) {
-    const info = { pageId };
-    if (params)
-        info.params = cloneDeep(params);
-    return info;
-}
-//# sourceMappingURL=utils.js.map
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.js.map b/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.js.map
deleted file mode 100644
index 6e28f17..0000000
--- a/node_modules/@blocksuite/affine-components/dist/rich-text/inline/presets/nodes/reference-node/utils.js.map
+++ /dev/null
@@ -1 +0,0 @@
-{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../../../src/rich-text/inline/presets/nodes/reference-node/utils.ts"],"names":[],"mappings":"AAEA,OAAO,SAAS,MAAM,kBAAkB,CAAC;AAEzC;;GAEG;AACH,MAAM,UAAU,kBAAkB,CAAC,EACjC,MAAM,EACN,MAAM,EACN,KAAK,EACL,WAAW,GACG;IACd,MAAM,IAAI,GAAkB,EAAE,MAAM,EAAE,CAAC;IACvC,IAAI,MAAM;QAAE,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;IAC5C,IAAI,KAAK;QAAE,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;IAC9B,IAAI,WAAW;QAAE,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IAChD,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,eAAe,CAAC,EAAE,MAAM,EAAiB;IACvD,IAAI,CAAC,MAAM;QAAE,OAAO,KAAK,CAAC;IAC1B,IAAI,CAAC,MAAM,CAAC,IAAI;QAAE,OAAO,KAAK,CAAC;IAC/B,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,UAAU,EAAE,aAAa,EAAE,GAAG,MAAM,CAAC;IACnE,IAAI,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC;QAAE,OAAO,IAAI,CAAC;IACjD,IAAI,UAAU,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC;QAAE,OAAO,IAAI,CAAC;IACrD,IAAI,UAAU,IAAI,aAAa;QAAE,OAAO,IAAI,CAAC;IAC7C,OAAO,KAAK,CAAC;AACf,CAAC;AAED;;;GAGG;AACH,MAAM,UAAU,gCAAgC,CAAC,EAC/C,MAAM,EACN,MAAM,GACQ;IACd,MAAM,IAAI,GAAkB,EAAE,MAAM,EAAE,CAAC;IACvC,IAAI,MAAM;QAAE,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;IAC5C,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import type { ReferenceInfo } from '@blocksuite/affine-model';\n\nimport cloneDeep from 'lodash.clonedeep';\n\n/**\n * Clones reference info.\n */\nexport function cloneReferenceInfo({\n  pageId,\n  params,\n  title,\n  description,\n}: ReferenceInfo) {\n  const info: ReferenceInfo = { pageId };\n  if (params) info.params = cloneDeep(params);\n  if (title) info.title = title;\n  if (description) info.description = description;\n  return info;\n}\n\n/**\n * Returns true if it is a link to block or element.\n */\nexport function referenceToNode({ params }: ReferenceInfo) {\n  if (!params) return false;\n  if (!params.mode) return false;\n  const { blockIds, elementIds, databaseId, databaseRowId } = params;\n  if (blockIds && blockIds.length > 0) return true;\n  if (elementIds && elementIds.length > 0) return true;\n  if (databaseId || databaseRowId) return true;\n  return false;\n}\n\n/**\n * Clones reference info without the aliases.\n * In `EmbedSyncedDocModel`, the aliases are not needed at the moment.\n */\nexport function cloneReferenceInfoWithoutAliases({\n  pageId,\n  params,\n}: ReferenceInfo) {\n  const info: ReferenceInfo = { pageId };\n  if (params) info.params = cloneDeep(params);\n  return info;\n}\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.d.ts.map b/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.d.ts.map
index e0dacee..a21f71f 100644
--- a/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"toggle-button.d.ts","sourceRoot":"","sources":["../../src/toggle-button/toggle-button.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AAQ1D,eAAO,MAAM,0BAA0B,oCAAoC,CAAC;;AAE5E,qBAAa,YAAa,SAAQ,iBAAiC;IACjE,OAAgB,MAAM,0BAgCpB;IAEO,MAAM;IA0Bf,QAAQ,CAAC,SAAS,EAAG,OAAO,CAAC;IAG7B,QAAQ,CAAC,eAAe,EAAG,CAAC,SAAS,EAAE,OAAO,KAAK,IAAI,CAAC;CACzD;AAED,OAAO,CAAC,MAAM,CAAC;IACb,UAAU,qBAAqB;QAC7B,0BAA0B,EAAE,YAAY,CAAC;KAC1C;CACF"}
\ No newline at end of file
+{"version":3,"file":"toggle-button.d.ts","sourceRoot":"","sources":["../../src/toggle-button/toggle-button.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AAQ1D,eAAO,MAAM,0BAA0B,oCAAoC,CAAC;;AAE5E,qBAAa,YAAa,SAAQ,iBAAiC;IACjE,OAAgB,MAAM,0BA+BpB;IAEO,MAAM;IA0Bf,QAAQ,CAAC,SAAS,EAAG,OAAO,CAAC;IAG7B,QAAQ,CAAC,eAAe,EAAG,CAAC,SAAS,EAAE,OAAO,KAAK,IAAI,CAAC;CACzD;AAED,OAAO,CAAC,MAAM,CAAC;IACb,UAAU,qBAAqB;QAC7B,0BAA0B,EAAE,YAAY,CAAC;KAC1C;CACF"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js b/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js
index a71f398..223fc37 100644
--- a/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js
+++ b/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js
@@ -59,9 +59,8 @@ let ToggleButton = (() => {
         static { this.styles = css `
     .toggle-icon {
       display: flex;
-      align-items: center;
-      height: 16px;
-      margin: 4px 0;
+      align-items: start;
+      margin-top: 0.45em;
       position: absolute;
       left: 0;
       transform: translateX(-100%);
diff --git a/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js.map b/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js.map
index 4097f40..5b089da 100644
--- a/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/toggle-button/toggle-button.js.map
@@ -1 +1 @@
-{"version":3,"file":"toggle-button.js","sourceRoot":"","sources":["../../src/toggle-button/toggle-button.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AAC1D,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,KAAK,CAAC;AACrC,OAAO,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC7C,OAAO,EAAE,IAAI,EAAE,MAAM,UAAU,CAAC;AAEhC,OAAO,EAAE,UAAU,EAAE,WAAW,EAAE,MAAM,kBAAkB,CAAC;AAE3D,MAAM,CAAC,MAAM,0BAA0B,GAAG,iCAAiC,CAAC;IAE/D,YAAY;sBAAS,cAAc,CAAC,iBAAiB,CAAC;;;;;;;iBAAtD,YAAa,SAAQ,WAAiC;;;qCA4DhE,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;2CAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAF/B,gLAAS,SAAS,6BAAT,SAAS,6FAAW;YAG7B,kMAAS,eAAe,6BAAf,eAAe,yGAAgC;;;iBA/DxC,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;OAsBvB,SAAS,CAAC,0BAA0B,CAAC;;;;;;;;;;GAUzC,CAAC;QAEO,MAAM;YACb,MAAM,kBAAkB,GAAG,IAAI,CAAA;;;;iBAIlB,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;;UAElD,UAAU;;KAEf,CAAC;YAEF,MAAM,mBAAmB,GAAG,IAAI,CAAA;;;;yBAIX,IAAI,CAAC,SAAS;iBACtB,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;;UAElD,WAAW;;KAEhB,CAAC;YAEF,OAAO,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,kBAAkB,CAAC;QACnE,CAAC;QAGD,uFAA6B;QAA7B,IAAS,SAAS,+CAAW;QAA7B,IAAS,SAAS,qDAAW;QAG7B,4JAAwD;QAAxD,IAAS,eAAe,qDAAgC;QAAxD,IAAS,eAAe,2DAAgC;;;;;;;SAhE7C,YAAY","sourcesContent":["import { ShadowlessElement } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { css, unsafeCSS } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { html } from 'lit-html';\n\nimport { toggleDown, toggleRight } from '../icons/list.js';\n\nexport const TOGGLE_BUTTON_PARENT_CLASS = 'blocksuite-toggle-button-parent';\n\nexport class ToggleButton extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .toggle-icon {\n      display: flex;\n      align-items: center;\n      height: 16px;\n      margin: 4px 0;\n      position: absolute;\n      left: 0;\n      transform: translateX(-100%);\n      border-radius: 4px;\n      cursor: pointer;\n      opacity: 0;\n      transition: opacity 0.2s ease-in-out;\n    }\n    .toggle-icon:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .toggle-icon[data-collapsed='true'] {\n      opacity: 1;\n    }\n\n    .${unsafeCSS(TOGGLE_BUTTON_PARENT_CLASS)}:hover .toggle-icon {\n      opacity: 1;\n    }\n\n    .with-drag-handle .toggle-icon {\n      opacity: 1;\n    }\n    .with-drag-handle .affine-block-children-container .toggle-icon {\n      opacity: 0;\n    }\n  `;\n\n  override render() {\n    const toggleDownTemplate = html`\n      <div\n        contenteditable=\"false\"\n        class=\"toggle-icon\"\n        @click=${() => this.updateCollapsed(!this.collapsed)}\n      >\n        ${toggleDown}\n      </div>\n    `;\n\n    const toggleRightTemplate = html`\n      <div\n        contenteditable=\"false\"\n        class=\"toggle-icon\"\n        data-collapsed=${this.collapsed}\n        @click=${() => this.updateCollapsed(!this.collapsed)}\n      >\n        ${toggleRight}\n      </div>\n    `;\n\n    return this.collapsed ? toggleRightTemplate : toggleDownTemplate;\n  }\n\n  @property({ attribute: false })\n  accessor collapsed!: boolean;\n\n  @property({ attribute: false })\n  accessor updateCollapsed!: (collapsed: boolean) => void;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'blocksuite-toggle-button': ToggleButton;\n  }\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"toggle-button.js","sourceRoot":"","sources":["../../src/toggle-button/toggle-button.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AAC1D,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,KAAK,CAAC;AACrC,OAAO,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC7C,OAAO,EAAE,IAAI,EAAE,MAAM,UAAU,CAAC;AAEhC,OAAO,EAAE,UAAU,EAAE,WAAW,EAAE,MAAM,kBAAkB,CAAC;AAE3D,MAAM,CAAC,MAAM,0BAA0B,GAAG,iCAAiC,CAAC;IAE/D,YAAY;sBAAS,cAAc,CAAC,iBAAiB,CAAC;;;;;;;iBAAtD,YAAa,SAAQ,WAAiC;;;qCA2DhE,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;2CAG9B,QAAQ,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC;YAF/B,gLAAS,SAAS,6BAAT,SAAS,6FAAW;YAG7B,kMAAS,eAAe,6BAAf,eAAe,yGAAgC;;;iBA9DxC,WAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;OAqBvB,SAAS,CAAC,0BAA0B,CAAC;;;;;;;;;;GAUzC,CAAC;QAEO,MAAM;YACb,MAAM,kBAAkB,GAAG,IAAI,CAAA;;;;iBAIlB,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;;UAElD,UAAU;;KAEf,CAAC;YAEF,MAAM,mBAAmB,GAAG,IAAI,CAAA;;;;yBAIX,IAAI,CAAC,SAAS;iBACtB,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;;UAElD,WAAW;;KAEhB,CAAC;YAEF,OAAO,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,kBAAkB,CAAC;QACnE,CAAC;QAGD,uFAA6B;QAA7B,IAAS,SAAS,+CAAW;QAA7B,IAAS,SAAS,qDAAW;QAG7B,4JAAwD;QAAxD,IAAS,eAAe,qDAAgC;QAAxD,IAAS,eAAe,2DAAgC;;;;;;;SA/D7C,YAAY","sourcesContent":["import { ShadowlessElement } from '@blocksuite/block-std';\nimport { WithDisposable } from '@blocksuite/global/utils';\nimport { css, unsafeCSS } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { html } from 'lit-html';\n\nimport { toggleDown, toggleRight } from '../icons/list.js';\n\nexport const TOGGLE_BUTTON_PARENT_CLASS = 'blocksuite-toggle-button-parent';\n\nexport class ToggleButton extends WithDisposable(ShadowlessElement) {\n  static override styles = css`\n    .toggle-icon {\n      display: flex;\n      align-items: start;\n      margin-top: 0.45em;\n      position: absolute;\n      left: 0;\n      transform: translateX(-100%);\n      border-radius: 4px;\n      cursor: pointer;\n      opacity: 0;\n      transition: opacity 0.2s ease-in-out;\n    }\n    .toggle-icon:hover {\n      background: var(--affine-hover-color);\n    }\n\n    .toggle-icon[data-collapsed='true'] {\n      opacity: 1;\n    }\n\n    .${unsafeCSS(TOGGLE_BUTTON_PARENT_CLASS)}:hover .toggle-icon {\n      opacity: 1;\n    }\n\n    .with-drag-handle .toggle-icon {\n      opacity: 1;\n    }\n    .with-drag-handle .affine-block-children-container .toggle-icon {\n      opacity: 0;\n    }\n  `;\n\n  override render() {\n    const toggleDownTemplate = html`\n      <div\n        contenteditable=\"false\"\n        class=\"toggle-icon\"\n        @click=${() => this.updateCollapsed(!this.collapsed)}\n      >\n        ${toggleDown}\n      </div>\n    `;\n\n    const toggleRightTemplate = html`\n      <div\n        contenteditable=\"false\"\n        class=\"toggle-icon\"\n        data-collapsed=${this.collapsed}\n        @click=${() => this.updateCollapsed(!this.collapsed)}\n      >\n        ${toggleRight}\n      </div>\n    `;\n\n    return this.collapsed ? toggleRightTemplate : toggleDownTemplate;\n  }\n\n  @property({ attribute: false })\n  accessor collapsed!: boolean;\n\n  @property({ attribute: false })\n  accessor updateCollapsed!: (collapsed: boolean) => void;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'blocksuite-toggle-button': ToggleButton;\n  }\n}\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts b/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts
index 8081f6a..b13ff7a 100644
--- a/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts
@@ -1,6 +1,7 @@
 export { EditorIconButton } from './icon-button.js';
 export { EditorMenuAction, EditorMenuButton, EditorMenuContent, } from './menu-button.js';
 export { EditorToolbarSeparator } from './separator.js';
+export { darkToolbarStyles, lightToolbarStyles } from './styles.js';
 export { EditorToolbar } from './toolbar.js';
 export { Tooltip } from './tooltip.js';
 export type { AdvancedMenuItem, FatMenuItems, MenuItem, MenuItemGroup, } from './types.js';
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts.map b/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts.map
index 4363539..3c54e74 100644
--- a/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts.map
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/index.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"index.d.ts","sourceRoot":"","sources":["../../src/toolbar/index.ts"],"names":[],"mappings":"AAUA,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EAChB,iBAAiB,GAClB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,gBAAgB,CAAC;AACxD,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,YAAY,EACV,gBAAgB,EAChB,YAAY,EACZ,QAAQ,EACR,aAAa,GACd,MAAM,YAAY,CAAC;AACpB,OAAO,EACL,WAAW,EACX,eAAe,EACf,aAAa,EACb,YAAY,EACZ,sBAAsB,GACvB,MAAM,YAAY,CAAC;AAEpB,wBAAgB,OAAO,SAQtB"}
\ No newline at end of file
+{"version":3,"file":"index.d.ts","sourceRoot":"","sources":["../../src/toolbar/index.ts"],"names":[],"mappings":"AAUA,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EAChB,iBAAiB,GAClB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,gBAAgB,CAAC;AACxD,OAAO,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,MAAM,aAAa,CAAC;AACpE,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,YAAY,EACV,gBAAgB,EAChB,YAAY,EACZ,QAAQ,EACR,aAAa,GACd,MAAM,YAAY,CAAC;AACpB,OAAO,EACL,WAAW,EACX,eAAe,EACf,aAAa,EACb,YAAY,EACZ,sBAAsB,GACvB,MAAM,YAAY,CAAC;AAEpB,wBAAgB,OAAO,SAQtB"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/index.js b/node_modules/@blocksuite/affine-components/dist/toolbar/index.js
index a346a26..fb90dc4 100644
--- a/node_modules/@blocksuite/affine-components/dist/toolbar/index.js
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/index.js
@@ -6,6 +6,7 @@ import { Tooltip } from './tooltip.js';
 export { EditorIconButton } from './icon-button.js';
 export { EditorMenuAction, EditorMenuButton, EditorMenuContent, } from './menu-button.js';
 export { EditorToolbarSeparator } from './separator.js';
+export { darkToolbarStyles, lightToolbarStyles } from './styles.js';
 export { EditorToolbar } from './toolbar.js';
 export { Tooltip } from './tooltip.js';
 export { cloneGroups, groupsToActions, renderActions, renderGroups, renderToolbarSeparator, } from './utils.js';
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/index.js.map b/node_modules/@blocksuite/affine-components/dist/toolbar/index.js.map
index 2682a11..20adfd2 100644
--- a/node_modules/@blocksuite/affine-components/dist/toolbar/index.js.map
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/index.js.map
@@ -1 +1 @@
-{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/toolbar/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EAChB,iBAAiB,GAClB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,gBAAgB,CAAC;AACxD,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AAEvC,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EAChB,iBAAiB,GAClB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,gBAAgB,CAAC;AACxD,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AAOvC,OAAO,EACL,WAAW,EACX,eAAe,EACf,aAAa,EACb,YAAY,EACZ,sBAAsB,GACvB,MAAM,YAAY,CAAC;AAEpB,MAAM,UAAU,OAAO;IACrB,cAAc,CAAC,MAAM,CAAC,0BAA0B,EAAE,sBAAsB,CAAC,CAAC;IAC1E,cAAc,CAAC,MAAM,CAAC,gBAAgB,EAAE,aAAa,CAAC,CAAC;IACvD,cAAc,CAAC,MAAM,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAC9D,cAAc,CAAC,MAAM,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAC9D,cAAc,CAAC,MAAM,CAAC,qBAAqB,EAAE,iBAAiB,CAAC,CAAC;IAChE,cAAc,CAAC,MAAM,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAC9D,cAAc,CAAC,MAAM,CAAC,gBAAgB,EAAE,OAAO,CAAC,CAAC;AACnD,CAAC","sourcesContent":["import { EditorIconButton } from './icon-button.js';\nimport {\n  EditorMenuAction,\n  EditorMenuButton,\n  EditorMenuContent,\n} from './menu-button.js';\nimport { EditorToolbarSeparator } from './separator.js';\nimport { EditorToolbar } from './toolbar.js';\nimport { Tooltip } from './tooltip.js';\n\nexport { EditorIconButton } from './icon-button.js';\nexport {\n  EditorMenuAction,\n  EditorMenuButton,\n  EditorMenuContent,\n} from './menu-button.js';\nexport { EditorToolbarSeparator } from './separator.js';\nexport { EditorToolbar } from './toolbar.js';\nexport { Tooltip } from './tooltip.js';\nexport type {\n  AdvancedMenuItem,\n  FatMenuItems,\n  MenuItem,\n  MenuItemGroup,\n} from './types.js';\nexport {\n  cloneGroups,\n  groupsToActions,\n  renderActions,\n  renderGroups,\n  renderToolbarSeparator,\n} from './utils.js';\n\nexport function effects() {\n  customElements.define('editor-toolbar-separator', EditorToolbarSeparator);\n  customElements.define('editor-toolbar', EditorToolbar);\n  customElements.define('editor-icon-button', EditorIconButton);\n  customElements.define('editor-menu-button', EditorMenuButton);\n  customElements.define('editor-menu-content', EditorMenuContent);\n  customElements.define('editor-menu-action', EditorMenuAction);\n  customElements.define('affine-tooltip', Tooltip);\n}\n"]}
\ No newline at end of file
+{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/toolbar/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EAChB,iBAAiB,GAClB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,gBAAgB,CAAC;AACxD,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AAEvC,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EACL,gBAAgB,EAChB,gBAAgB,EAChB,iBAAiB,GAClB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,gBAAgB,CAAC;AACxD,OAAO,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,MAAM,aAAa,CAAC;AACpE,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AAOvC,OAAO,EACL,WAAW,EACX,eAAe,EACf,aAAa,EACb,YAAY,EACZ,sBAAsB,GACvB,MAAM,YAAY,CAAC;AAEpB,MAAM,UAAU,OAAO;IACrB,cAAc,CAAC,MAAM,CAAC,0BAA0B,EAAE,sBAAsB,CAAC,CAAC;IAC1E,cAAc,CAAC,MAAM,CAAC,gBAAgB,EAAE,aAAa,CAAC,CAAC;IACvD,cAAc,CAAC,MAAM,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAC9D,cAAc,CAAC,MAAM,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAC9D,cAAc,CAAC,MAAM,CAAC,qBAAqB,EAAE,iBAAiB,CAAC,CAAC;IAChE,cAAc,CAAC,MAAM,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAC9D,cAAc,CAAC,MAAM,CAAC,gBAAgB,EAAE,OAAO,CAAC,CAAC;AACnD,CAAC","sourcesContent":["import { EditorIconButton } from './icon-button.js';\nimport {\n  EditorMenuAction,\n  EditorMenuButton,\n  EditorMenuContent,\n} from './menu-button.js';\nimport { EditorToolbarSeparator } from './separator.js';\nimport { EditorToolbar } from './toolbar.js';\nimport { Tooltip } from './tooltip.js';\n\nexport { EditorIconButton } from './icon-button.js';\nexport {\n  EditorMenuAction,\n  EditorMenuButton,\n  EditorMenuContent,\n} from './menu-button.js';\nexport { EditorToolbarSeparator } from './separator.js';\nexport { darkToolbarStyles, lightToolbarStyles } from './styles.js';\nexport { EditorToolbar } from './toolbar.js';\nexport { Tooltip } from './tooltip.js';\nexport type {\n  AdvancedMenuItem,\n  FatMenuItems,\n  MenuItem,\n  MenuItemGroup,\n} from './types.js';\nexport {\n  cloneGroups,\n  groupsToActions,\n  renderActions,\n  renderGroups,\n  renderToolbarSeparator,\n} from './utils.js';\n\nexport function effects() {\n  customElements.define('editor-toolbar-separator', EditorToolbarSeparator);\n  customElements.define('editor-toolbar', EditorToolbar);\n  customElements.define('editor-icon-button', EditorIconButton);\n  customElements.define('editor-menu-button', EditorMenuButton);\n  customElements.define('editor-menu-content', EditorMenuContent);\n  customElements.define('editor-menu-action', EditorMenuAction);\n  customElements.define('affine-tooltip', Tooltip);\n}\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/styles.d.ts b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.d.ts
new file mode 100644
index 0000000..17d5955
--- /dev/null
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.d.ts
@@ -0,0 +1,3 @@
+export declare const lightToolbarStyles: string[];
+export declare const darkToolbarStyles: string[];
+//# sourceMappingURL=styles.d.ts.map
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/styles.d.ts.map b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.d.ts.map
new file mode 100644
index 0000000..e3a760f
--- /dev/null
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"styles.d.ts","sourceRoot":"","sources":["../../src/toolbar/styles.ts"],"names":[],"mappings":"AAsBA,eAAO,MAAM,kBAAkB,UAE9B,CAAC;AAEF,eAAO,MAAM,iBAAiB,UAE7B,CAAC"}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/styles.js b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.js
new file mode 100644
index 0000000..c7a8dc6
--- /dev/null
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.js
@@ -0,0 +1,19 @@
+import { combinedDarkCssVariables, combinedLightCssVariables, } from '@toeverything/theme';
+import { unsafeCSS } from 'lit';
+const toolbarColorKeys = [
+    '--affine-background-overlay-panel-color',
+    '--affine-v2-layer-background-overlayPanel',
+    '--affine-background-error-color',
+    '--affine-background-primary-color',
+    '--affine-background-tertiary-color',
+    '--affine-icon-color',
+    '--affine-icon-secondary',
+    '--affine-border-color',
+    '--affine-divider-color',
+    '--affine-text-primary-color',
+    '--affine-hover-color',
+    '--affine-hover-color-filled',
+];
+export const lightToolbarStyles = toolbarColorKeys.map(key => `${key}: ${unsafeCSS(combinedLightCssVariables[key])};`);
+export const darkToolbarStyles = toolbarColorKeys.map(key => `${key}: ${unsafeCSS(combinedDarkCssVariables[key])};`);
+//# sourceMappingURL=styles.js.map
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/dist/toolbar/styles.js.map b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.js.map
new file mode 100644
index 0000000..b95fda1
--- /dev/null
+++ b/node_modules/@blocksuite/affine-components/dist/toolbar/styles.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"styles.js","sourceRoot":"","sources":["../../src/toolbar/styles.ts"],"names":[],"mappings":"AAAA,OAAO,EAEL,wBAAwB,EACxB,yBAAyB,GAC1B,MAAM,qBAAqB,CAAC;AAC7B,OAAO,EAAE,SAAS,EAAE,MAAM,KAAK,CAAC;AAEhC,MAAM,gBAAgB,GAAoC;IACxD,yCAAyC;IACzC,2CAAoD;IACpD,iCAAiC;IACjC,mCAAmC;IACnC,oCAAoC;IACpC,qBAAqB;IACrB,yBAAyB;IACzB,uBAAuB;IACvB,wBAAwB;IACxB,6BAA6B;IAC7B,sBAAsB;IACtB,6BAA6B;CAC9B,CAAC;AAEF,MAAM,CAAC,MAAM,kBAAkB,GAAG,gBAAgB,CAAC,GAAG,CACpD,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,KAAK,SAAS,CAAC,yBAAyB,CAAC,GAAG,CAAC,CAAC,GAAG,CAC/D,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,GAAG,CACnD,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,KAAK,SAAS,CAAC,wBAAwB,CAAC,GAAG,CAAC,CAAC,GAAG,CAC9D,CAAC","sourcesContent":["import {\n  type AffineCssVariables,\n  combinedDarkCssVariables,\n  combinedLightCssVariables,\n} from '@toeverything/theme';\nimport { unsafeCSS } from 'lit';\n\nconst toolbarColorKeys: Array<keyof AffineCssVariables> = [\n  '--affine-background-overlay-panel-color',\n  '--affine-v2-layer-background-overlayPanel' as never,\n  '--affine-background-error-color',\n  '--affine-background-primary-color',\n  '--affine-background-tertiary-color',\n  '--affine-icon-color',\n  '--affine-icon-secondary',\n  '--affine-border-color',\n  '--affine-divider-color',\n  '--affine-text-primary-color',\n  '--affine-hover-color',\n  '--affine-hover-color-filled',\n];\n\nexport const lightToolbarStyles = toolbarColorKeys.map(\n  key => `${key}: ${unsafeCSS(combinedLightCssVariables[key])};`\n);\n\nexport const darkToolbarStyles = toolbarColorKeys.map(\n  key => `${key}: ${unsafeCSS(combinedDarkCssVariables[key])};`\n);\n"]}
\ No newline at end of file
diff --git a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/affine-inline-specs.ts b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/affine-inline-specs.ts
index 0015617..791a67c 100644
--- a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/affine-inline-specs.ts
+++ b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/affine-inline-specs.ts
@@ -124,12 +124,6 @@ export const ReferenceInlineSpecExtension = InlineSpecExtension(
     if (config.customContent) {
       configProvider.setCustomContent(config.customContent);
     }
-    if (config.customIcon) {
-      configProvider.setCustomIcon(config.customIcon);
-    }
-    if (config.customTitle) {
-      configProvider.setCustomTitle(config.customTitle);
-    }
     if (config.interactable !== undefined) {
       configProvider.setInteractable(config.interactable);
     }
diff --git a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/index.ts b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/index.ts
index 6c0d732..cd6e947 100644
--- a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/index.ts
+++ b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/index.ts
@@ -4,8 +4,3 @@ export * from './reference-node/reference-config.js';
 
 export { AffineReference } from './reference-node/reference-node.js';
 export type { RefNodeSlots } from './reference-node/types.js';
-export {
-  cloneReferenceInfo,
-  cloneReferenceInfoWithoutAliases,
-  referenceToNode,
-} from './reference-node/utils.js';
diff --git a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-config.ts b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-config.ts
index 82d490f..ae4c956 100644
--- a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-config.ts
+++ b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-config.ts
@@ -6,9 +6,7 @@ import { createIdentifier } from '@blocksuite/global/di';
 import type { AffineReference } from './reference-node.js';
 
 export interface ReferenceNodeConfig {
-  customContent?: ((reference: AffineReference) => TemplateResult) | null;
-  customIcon?: ((reference: AffineReference) => TemplateResult) | null;
-  customTitle?: ((reference: AffineReference) => string) | null;
+  customContent?: (reference: AffineReference) => TemplateResult;
   interactable?: boolean;
   hidePopup?: boolean;
 }
@@ -29,12 +27,7 @@ export function ReferenceNodeConfigExtension(
 export class ReferenceNodeConfigProvider {
   private _customContent:
     | ((reference: AffineReference) => TemplateResult)
-    | null = null;
-
-  private _customIcon: ((reference: AffineReference) => TemplateResult) | null =
-    null;
-
-  private _customTitle: ((reference: AffineReference) => string) | null = null;
+    | undefined = undefined;
 
   private _hidePopup = false;
 
@@ -44,14 +37,6 @@ export class ReferenceNodeConfigProvider {
     return this._customContent;
   }
 
-  get customIcon() {
-    return this._customIcon;
-  }
-
-  get customTitle() {
-    return this._customTitle;
-  }
-
   get doc() {
     return this.std.doc;
   }
@@ -70,14 +55,6 @@ export class ReferenceNodeConfigProvider {
     this._customContent = content;
   }
 
-  setCustomIcon(icon: ReferenceNodeConfigProvider['_customIcon']) {
-    this._customIcon = icon;
-  }
-
-  setCustomTitle(title: ReferenceNodeConfigProvider['_customTitle']) {
-    this._customTitle = title;
-  }
-
   setHidePopup(hidePopup: boolean) {
     this._hidePopup = hidePopup;
   }
diff --git a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-node.ts b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-node.ts
index 75894b4..8d3b31a 100644
--- a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-node.ts
+++ b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-node.ts
@@ -2,6 +2,11 @@ import type { ReferenceInfo } from '@blocksuite/affine-model';
 import type { AffineTextAttributes } from '@blocksuite/affine-shared/types';
 import type { Doc, DocMeta } from '@blocksuite/store';
 
+import { DocDisplayMetaProvider } from '@blocksuite/affine-shared/services';
+import {
+  cloneReferenceInfo,
+  referenceToNode,
+} from '@blocksuite/affine-shared/utils';
 import {
   BLOCK_ID_ATTR,
   type BlockComponent,
@@ -9,7 +14,7 @@ import {
 } from '@blocksuite/block-std';
 import { BlockSuiteError, ErrorCode } from '@blocksuite/global/exceptions';
 import { WithDisposable } from '@blocksuite/global/utils';
-import { AliasIcon } from '@blocksuite/icons/lit';
+import { LinkedPageIcon } from '@blocksuite/icons/lit';
 import {
   type DeltaInsert,
   INLINE_ROOT_ATTR,
@@ -20,23 +25,18 @@ import {
 import { css, html, nothing } from 'lit';
 import { property, state } from 'lit/decorators.js';
 import { choose } from 'lit/directives/choose.js';
+import { ifDefined } from 'lit/directives/if-defined.js';
 import { ref } from 'lit/directives/ref.js';
 import { styleMap } from 'lit/directives/style-map.js';
 
 import type { ReferenceNodeConfigProvider } from './reference-config.js';
 
 import { HoverController } from '../../../../../hover/index.js';
-import {
-  BlockLinkIcon,
-  FontDocIcon,
-  FontLinkedDocIcon,
-} from '../../../../../icons/index.js';
 import { Peekable } from '../../../../../peek/index.js';
 import { RefNodeSlotsProvider } from '../../../../extension/index.js';
 import { affineTextStyles } from '../affine-text.js';
 import { DEFAULT_DOC_NAME, REFERENCE_NODE } from '../consts.js';
 import { toggleReferencePopup } from './reference-popup.js';
-import { cloneReferenceInfo, referenceToNode } from './utils.js';
 
 @Peekable({ action: false })
 export class AffineReference extends WithDisposable(ShadowlessElement) {
@@ -132,6 +132,23 @@ export class AffineReference extends WithDisposable(ShadowlessElement) {
     { enterDelay: 500 }
   );
 
+  get _icon() {
+    const { pageId, params, title } = this.referenceInfo;
+    return this.block?.std
+      ?.get(DocDisplayMetaProvider)
+      .icon(pageId, { params, title, referenced: true }).value;
+  }
+
+  get _title() {
+    const { pageId, params, title } = this.referenceInfo;
+    return (
+      title ||
+      this.block?.std
+        ?.get(DocDisplayMetaProvider)
+        .title(pageId, { params, title, referenced: true }).value
+    );
+  }
+
   get block() {
     const block = this.inlineEditor?.rootElement.closest<BlockComponent>(
       `[${BLOCK_ID_ATTR}]`
@@ -143,14 +160,6 @@ export class AffineReference extends WithDisposable(ShadowlessElement) {
     return this.config.customContent;
   }
 
-  get customIcon() {
-    return this.config.customIcon;
-  }
-
-  get customTitle() {
-    return this.config.customTitle;
-  }
-
   get doc() {
     const doc = this.config.doc;
     return doc;
@@ -242,31 +251,20 @@ export class AffineReference extends WithDisposable(ShadowlessElement) {
       return nothing;
     }
 
-    const hasTitleAlias = Boolean(
-      reference?.title && reference.title.length > 0
-    );
-    const title = this.customTitle
-      ? this.customTitle(this)
-      : isDeleted
-        ? 'Deleted doc'
-        : reference?.title || refMeta.title || DEFAULT_DOC_NAME;
-
-    const icon = choose(
-      type,
+    const title = this._title;
+    const icon = choose(type, [
+      ['LinkedPage', () => this._icon],
       [
-        [
-          'LinkedPage',
-          () =>
-            hasTitleAlias
-              ? AliasIcon()
-              : this.referenceToNode()
-                ? BlockLinkIcon
-                : FontLinkedDocIcon,
-        ],
-        ['Subpage', () => FontDocIcon],
+        'Subpage',
+        () =>
+          LinkedPageIcon({
+            width: '1.25em',
+            height: '1.25em',
+            style:
+              'user-select:none;flex-shrink:0;vertical-align:middle;font-size:inherit;margin-bottom:0.1em;',
+          }),
       ],
-      () => this.customIcon?.(this) ?? nothing
-    );
+    ]);
 
     const style = affineTextStyles(
       attributes,
@@ -281,7 +279,9 @@ export class AffineReference extends WithDisposable(ShadowlessElement) {
 
     const content = this.customContent
       ? this.customContent(this)
-      : html`${icon}<span data-title=${title} class="affine-reference-title"
+      : html`${icon}<span
+            data-title=${ifDefined(title)}
+            class="affine-reference-title"
             >${title}</span
           >`;
 
diff --git a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts
index 734ff7a..62e05cb 100644
--- a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts
+++ b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/reference-popup.ts
@@ -7,7 +7,10 @@ import {
   type TelemetryEvent,
   TelemetryProvider,
 } from '@blocksuite/affine-shared/services';
-import { isInsideBlockByFlavour } from '@blocksuite/affine-shared/utils';
+import {
+  cloneReferenceInfoWithoutAliases,
+  isInsideBlockByFlavour,
+} from '@blocksuite/affine-shared/utils';
 import {
   BLOCK_ID_ATTR,
   type BlockComponent,
@@ -45,7 +48,6 @@ import {
 import { RefNodeSlotsProvider } from '../../../../extension/index.js';
 import { ReferenceAliasPopup } from './reference-alias-popup.js';
 import { styles } from './styles.js';
-import { cloneReferenceInfoWithoutAliases } from './utils.js';
 
 export class ReferencePopup extends WithDisposable(LitElement) {
   static override styles = styles;
@@ -74,6 +76,10 @@ export class ReferencePopup extends WithDisposable(LitElement) {
   private _openEditPopup = (e: MouseEvent) => {
     e.stopPropagation();
 
+    if (document.body.querySelector('reference-alias-popup')) {
+      return;
+    }
+
     const {
       std,
       docTitle,
diff --git a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/utils.ts b/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/utils.ts
deleted file mode 100644
index c0f0ee0..0000000
--- a/node_modules/@blocksuite/affine-components/src/rich-text/inline/presets/nodes/reference-node/utils.ts
+++ /dev/null
@@ -1,45 +0,0 @@
-import type { ReferenceInfo } from '@blocksuite/affine-model';
-
-import cloneDeep from 'lodash.clonedeep';
-
-/**
- * Clones reference info.
- */
-export function cloneReferenceInfo({
-  pageId,
-  params,
-  title,
-  description,
-}: ReferenceInfo) {
-  const info: ReferenceInfo = { pageId };
-  if (params) info.params = cloneDeep(params);
-  if (title) info.title = title;
-  if (description) info.description = description;
-  return info;
-}
-
-/**
- * Returns true if it is a link to block or element.
- */
-export function referenceToNode({ params }: ReferenceInfo) {
-  if (!params) return false;
-  if (!params.mode) return false;
-  const { blockIds, elementIds, databaseId, databaseRowId } = params;
-  if (blockIds && blockIds.length > 0) return true;
-  if (elementIds && elementIds.length > 0) return true;
-  if (databaseId || databaseRowId) return true;
-  return false;
-}
-
-/**
- * Clones reference info without the aliases.
- * In `EmbedSyncedDocModel`, the aliases are not needed at the moment.
- */
-export function cloneReferenceInfoWithoutAliases({
-  pageId,
-  params,
-}: ReferenceInfo) {
-  const info: ReferenceInfo = { pageId };
-  if (params) info.params = cloneDeep(params);
-  return info;
-}
diff --git a/node_modules/@blocksuite/affine-components/src/toggle-button/toggle-button.ts b/node_modules/@blocksuite/affine-components/src/toggle-button/toggle-button.ts
index 3f00e53..3ddd1be 100644
--- a/node_modules/@blocksuite/affine-components/src/toggle-button/toggle-button.ts
+++ b/node_modules/@blocksuite/affine-components/src/toggle-button/toggle-button.ts
@@ -12,9 +12,8 @@ export class ToggleButton extends WithDisposable(ShadowlessElement) {
   static override styles = css`
     .toggle-icon {
       display: flex;
-      align-items: center;
-      height: 16px;
-      margin: 4px 0;
+      align-items: start;
+      margin-top: 0.45em;
       position: absolute;
       left: 0;
       transform: translateX(-100%);
diff --git a/node_modules/@blocksuite/affine-components/src/toolbar/index.ts b/node_modules/@blocksuite/affine-components/src/toolbar/index.ts
index fca8228..43aa802 100644
--- a/node_modules/@blocksuite/affine-components/src/toolbar/index.ts
+++ b/node_modules/@blocksuite/affine-components/src/toolbar/index.ts
@@ -15,6 +15,7 @@ export {
   EditorMenuContent,
 } from './menu-button.js';
 export { EditorToolbarSeparator } from './separator.js';
+export { darkToolbarStyles, lightToolbarStyles } from './styles.js';
 export { EditorToolbar } from './toolbar.js';
 export { Tooltip } from './tooltip.js';
 export type {
diff --git a/node_modules/@blocksuite/affine-components/src/toolbar/styles.ts b/node_modules/@blocksuite/affine-components/src/toolbar/styles.ts
new file mode 100644
index 0000000..9718aae
--- /dev/null
+++ b/node_modules/@blocksuite/affine-components/src/toolbar/styles.ts
@@ -0,0 +1,29 @@
+import {
+  type AffineCssVariables,
+  combinedDarkCssVariables,
+  combinedLightCssVariables,
+} from '@toeverything/theme';
+import { unsafeCSS } from 'lit';
+
+const toolbarColorKeys: Array<keyof AffineCssVariables> = [
+  '--affine-background-overlay-panel-color',
+  '--affine-v2-layer-background-overlayPanel' as never,
+  '--affine-background-error-color',
+  '--affine-background-primary-color',
+  '--affine-background-tertiary-color',
+  '--affine-icon-color',
+  '--affine-icon-secondary',
+  '--affine-border-color',
+  '--affine-divider-color',
+  '--affine-text-primary-color',
+  '--affine-hover-color',
+  '--affine-hover-color-filled',
+];
+
+export const lightToolbarStyles = toolbarColorKeys.map(
+  key => `${key}: ${unsafeCSS(combinedLightCssVariables[key])};`
+);
+
+export const darkToolbarStyles = toolbarColorKeys.map(
+  key => `${key}: ${unsafeCSS(combinedDarkCssVariables[key])};`
+);
